<!DOCTYPE html>
<html lang="en">
<head>
     
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Movie & Trailer App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
       :root {
    --primary: #d81b60;
    --primary-dark: #ad1457;
    --glow: rgba(216, 27, 96, 0.5);
    --anime: #e91e63;
    --anime-dark: #c2185b;
    --bg: #0a0a0e;
    --card-bg: linear-gradient(145deg, #1a1a22, #2a2a32);
    --text: #f0f0f0;
    --text-secondary: #b0b0b0;
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 60px;
            transition: background 0.3s ease;
        }

        body.light-mode {
            --bg: #f5f5f5;
            --card-bg: linear-gradient(145deg, #ffffff, #e0e0e0);
            --text: #333333;
            --text-secondary: #666666;
            --glow: rgba(138, 43, 226, 0.2);
        }

        .search-container {
            height: 60px;
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 14, 0.85);
            backdrop-filter: blur(12px);
            padding: 10px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: var(--transition);
        }

        body.light-mode .search-container {
            background: rgba(245, 245, 245, 0.85);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 600px;
            display: flex;
            align-items: center;
        }

        .search-container input {
            padding: 12px 20px;
            font-size: 16px;
            width: 100%;
            border: 1px solid transparent;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            text-align: left;
            transition: var(--transition);
            box-shadow: 0 0 10px var(--glow);
        }

        .search-container input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--glow);
            background: rgba(255, 255, 255, 0.12);
        }

        body.light-mode .search-container input {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text);
        }

        .search-container input::placeholder {
            color: var(--text-secondary);
            animation: pulse-placeholder 3s infinite;
        }

        @keyframes pulse-placeholder {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

       /* Search button */
.search-container button {
    padding: 12px 20px;
    font-size: 16px;
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 30px;
    margin-left: 10px;
    transition: var(--transition);
    box-shadow: 0 0 10px var(--glow);
}

.search-container button:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

/* Reload button */
.reload-btn {
    padding: 12px;
    background: var(--primary);
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 50%;
    margin-right: 10px;
    transition: var(--transition);
    box-shadow: 0 0 10px var(--glow);
}

.reload-btn:hover {
    background: var(--primary-dark);
    transform: rotate(90deg);
}

/* Carousel nav */
.carousel-nav:hover {
    background: var(--primary);
    box-shadow: 0 0 10px var(--glow);
}

/* Favorite button */
.favorite-btn:hover {
    transform: scale(1.2);
    background: rgba(216, 27, 96, 0.3);
}

/* Pagination buttons */
.pagination button {
    padding: 10px 20px;
    font-size: 14px;
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: var(--transition);
    background: var(--primary);
    box-shadow: 0 0 10px var(--glow);
}

.pagination button:hover:not(:disabled) {
    background: var(--primary-dark);
    transform: scale(1.05);
}

/* Settings icon */
.settings-icon.account {
    background: var(--primary);
}

        .search-history {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 600px;
            background: rgba(26, 26, 34, 0.95);
            border-radius: 15px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
        }

        body.light-mode .search-history {
            background: rgba(255, 255, 255, 0.95);
        }

        .search-history-item {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text);
        }

        .search-history-item:hover {
            background: var(--primary);
            color: white;
        }

        .carousel-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            margin: 0 auto 40px;
            padding: 20px 0;
            background: linear-gradient(180deg, rgba(138, 43, 226, 0.1), transparent);
        }

        .carousel-track {
            display: flex;
            gap: 20px;
            padding: 0 20px;
            transition: transform 0.6s ease;
        }

        .carousel-item {
            flex: 0 0 calc(80% - 20px);
            min-width: 0;
            aspect-ratio: 16/9;
            position: relative;
            transform: perspective(1000px) rotateY(0deg);
            transition: var(--transition);
        }

        .carousel-item:hover {
            transform: perspective(1000px) rotateY(5deg) scale(1.02);
        }

        @media (min-width: 768px) {
            .carousel-item {
                flex: 0 0 calc(50% - 20px);
            }
        }

        @media (min-width: 1024px) {
            .carousel-item {
                flex: 0 0 calc(33.33% - 20px);
            }
        }

        .carousel-item .thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .carousel-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            color: white;
            opacity: 0;
            transition: var(--transition);
        }

        .carousel-item:hover .carousel-overlay {
            opacity: 1;
        }

        .carousel-overlay h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .carousel-overlay p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            color: white;
            font-size: 24px;
            transition: var(--transition);
        }

        .carousel-nav:hover {
            background: var(--primary);
        }

        .carousel-prev {
            left: 10px;
        }

        .carousel-next {
            right: 10px;
        }

        .content {
            margin-top: 20px;
            padding-bottom: 20px;
        }

        .section-title {
            padding: 15px 20px;
            font-size: 24px;
            font-weight: 800;
            position: relative;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #forYouSection .section-title {
            color: var(--anime);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 20px;
            width: 50px;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        #forYouSection .section-title::after {
            background: var(--anime);
        }

        .section-title:hover::after {
            width: 100px;
        }

        body.light-mode .section-title {
            color: var(--text);
        }

        .results-container {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease;
        }

        @media (min-width: 768px) {
            .results-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .results-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            border: 1px solid transparent;
        }

        .card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 12px 24px var(--glow);
            border: 1px solid var(--primary);
        }

        .thumbnail {
            width: 100%;
            height: 220px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .card:hover .thumbnail {
            transform: scale(1.05);
        }

        .card-content {
            padding: 15px;
            background: rgba(0,0,0,0.2);
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.light-mode .video-title {
            color: var(--text);
        }

        .channel {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .views-count {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .likes-count {
            background: rgba(255, 50, 50, 0.3);
            padding: 4px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trending-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 1.5s infinite;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            z-index: 2;
        }

        .favorite-btn.active {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.3);
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn i {
            pointer-events: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pagination-container {
            position: fixed;
            bottom: 70px;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.9);
            padding: 15px 0;
            display: flex;
            justify-content: center;
            z-index: 999;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
            transition: var(--transition);
        }

        body.light-mode .pagination-container {
            background: rgba(245, 245, 245, 0.9);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        }

        .pagination {
            display: flex;
            gap: 15px;
        }

        .pagination button {
            padding: 10px 20px;
            font-size: 14px;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--primary);
            box-shadow: 0 0 10px var(--glow);
        }

        .pagination button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .pagination button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            z-index: 1001;
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.2);
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(138, 43, 226, 0.9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            z-index: 1001;
            display: none;
            max-width: 80%;
        }

      /* Me Page Styles */
#mePage {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.profile-header {
    position: relative;
    margin: 0 15px 30px;
    padding: 0;
    background: transparent;
    border-radius: 15px;
    overflow: hidden;
    text-align: center;
}

.profile-banner {
    height: 150px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 0;
}

.profile-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent);
    opacity: 0.5;
    z-index: 1;
}

.profile-avatar-container {
    margin-top: -60px;
    z-index: 2;
}

.profile-avatar {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto;
    cursor: pointer;
    transition: var(--transition);
}

.profile-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid var(--card-bg);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    transition: var(--transition);
}

.profile-avatar:hover img {
    transform: scale(1.1);
    box-shadow: 0 0 20px var(--glow);
}

.avatar-glow {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    box-shadow: 0 0 15px var(--glow), 0 0 30px var(--glow);
    opacity: 0.7;
    animation: pulse 2s infinite ease-in-out;
    z-index: -1;
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 0.7; }
}

.profile-header {
    position: relative;
    margin: 0 15px 20px; /* Reduced bottom margin */
    padding: 0;
    background: transparent;
    border-radius: 15px;
    overflow: hidden;
    text-align: center;
}

.profile-header p {
    font-size: 16px;
    color: var(--text-secondary);
    margin: 0;
}



.edit-profile-btn {
    display: block;
    margin: 0 auto;
    padding: 12px 30px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: var(--transition);
    box-shadow: 0 0 10px var(--glow);
}

.edit-profile-btn:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

body.light-mode .profile-header h3 {
    color: #333;
}

body.light-mode .profile-header p {
    color: #666;
}

body.light-mode .profile-stats {
    background: linear-gradient(145deg, #ffffff, #e0e0e0);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

body.light-mode .profile-banner {
    background: linear-gradient(135deg, #e91e63, #ad1457);
}


.profile-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    text-align: center;
    text-transform: capitalize;
    overflow: hidden;
    padding: 5px;
}

.profile-avatar span {
    line-height: 1.2;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.profile-info h3 {
    margin: 0;
    font-size: 18px;
    color: var(--text-color);
}

.profile-info p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.me-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.stat-card {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.stat-card i {
    font-size: 24px;
    color: var(--primary);
    margin-bottom: 10px;
}

.stat-card h4 {
    margin: 0;
    font-size: 16px;
    color: var(--text-color);
}

.stat-card p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.settings-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.settings-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.settings-item:hover {
    background: var(--hover-bg);
}

.settings-item i:first-child {
    font-size: 20px;
    color: var(--primary);
    margin-right: 10px;
}

.settings-item span {
    flex: 1;
    font-size: 16px;
    color: var(--text-color);
}

.settings-item i:last-child {
    font-size: 16px;
    color: var(--text-secondary);
}

/* Modal Styles (for Account and Notification Modals) */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    width: 90%;
    position: relative;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.modal-content .close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
    color: var(--text-secondary);
}

.modal-content .close:hover {
    color: var(--primary);
}

.modal-content h3 {
    margin: 0 0 15px;
    font-size: 18px;
    color: var(--text-color);
}

.modal-input {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 14px;
}

.modal-actions {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}

.modal-btn.primary {
    background: var(--primary);
    color: white;
}

.modal-btn.secondary {
    background: var(--secondary);
    color: var(--text-color);
}

.modal-btn:hover {
    opacity: 0.9;
}


#accountModal .modal-content {
    padding: 20px;
    text-align: center;
}

#accountModal form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#accountModal button {
    padding: 10px;
    margin: 5px;
    width: 100px;
    align-self: center;
}
/* Theme Variables (ensure these are defined) */
:root {
    --primary: #6200ea;
    --secondary: #e0e0e0;
    --card-bg: #ffffff;
    --text-color: #212121;
    --text-secondary: #757575;
    --border-color: #e0e0e0;
    --input-bg: #f5f5f5;
    --hover-bg: #f0f0f0;
}

.dark-mode {
    --primary: #d81b60;
    --primary-dark: #ad1457;
    --glow: rgba(216, 27, 96, 0.5);
    --card-bg: #424242;
    --text-color: #ffffff;
    --text-secondary: #b0b0b0;
    --border-color: #616161;
    --input-bg: #616161;
    --hover-bg: #616161;
}

        .theme-switcher {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .theme-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: var(--transition);
        }

        .theme-btn.dark {
            background: #333;
            color: white;
        }

        .theme-btn.light {
            background: #f0f0f0;
            color: #333;
        }

        .theme-btn.active {
            outline: 2px solid var(--primary);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        body.light-mode .bottom-nav {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: 10px;
        }

        .nav-item i {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(138, 43, 226, 0.1);
        }

        .nav-item:hover {
            color: var(--primary);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.6;
        }

        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .search-container input {
                width: 100%;
                font-size: 14px;
                padding: 10px 15px;
            }

            .search-container button {
                font-size: 14px;
                padding: 10px 15px;
            }

            .thumbnail {
                height: 180px;
            }

            .video-title {
                font-size: 14px;
            }

            .channel {
                font-size: 12px;
            }

            .pagination button {
                padding: 8px 15px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .search-container {
                padding: 8px;
            }

            .thumbnail {
                height: 160px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
        }

        .modal-content {
            background: var(--card-bg);
            max-width: 400px;
            margin: 20vh auto;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-input, .modal-input select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            transition: var(--transition);
        }

        body.light-mode .modal-input, body.light-mode .modal-input select {
            background: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        #mePage ~ .pagination-container {
            display: none !important;
        }

        .notification-list {
            text-align: left;
            margin-top: 20px;
            padding-left: 25px;
            color: var(--text-secondary);
        }

        .notification-list li {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .profile-header {
            position: relative;
            margin-bottom: 60px;
        }

        .profile-banner {
            height: 120px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 0 0 15px 15px;
        }

        .profile-avatar-container {
            text-align: center;
            margin-top: -50px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--card-bg);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 3px solid var(--card-bg);
        }

        .profile-avatar i {
            font-size: 40px;
            color: var(--primary);
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: var(--card-bg);
            margin: 0 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 0 20px;
        }

        .settings-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
        }

        .settings-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .settings-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .settings-icon.account {
            background: var(--primary);
        }

        .settings-icon.appearance {
            background: #6a1b9a;
        }

        .settings-icon.notifications {
            background: #e91e63;
        }

        .settings-icon.about {
            background: #2196F3;
        }

        .settings-card h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .settings-card p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        @media (max-width: 480px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            .profile-banner {
                height: 100px;
            }
        }


        /* Shorts Page Styles */
/* Enhanced Shorts Player Styles */
.shorts-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 0;
    width: 100%;
    max-width: 100%;
    margin: 0 auto;
    scroll-snap-type: y mandatory;
    overflow-y: auto;
    height: calc(100vh - 180px); /* Adjust based on your header/footer height */
}

.shorts-card {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 80vh;
    scroll-snap-align: start;
    background: #000;
    border-radius: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.shorts-player {
    width: 100%;
    height: 100%;
    min-height: 80vh;
    object-fit: contain;
    background: #000;
    border: none;
}

.shorts-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 16px;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    color: white;
    z-index: 2;
}

.shorts-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.shorts-channel {
    font-size: 14px;
    color: var(--text-secondary);
}

.shorts-controls {
    position: absolute;
    right: 16px;
    bottom: 100px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    z-index: 3;
}

.shorts-control-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    cursor: pointer;
    transition: var(--transition);
}

.shorts-control-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

.shorts-control-btn i {
    pointer-events: none;
}

.shorts-control-btn.active i {
    color: #ff0000; /* Red heart when liked */
}

.shorts-autoplay {
    position: absolute;
    top: 16px;
    right: 16px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    z-index: 3;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .shorts-container {
        height: calc(100vh - 160px);
    }
    
    .shorts-card {
        min-height: 75vh;
    }
    
    .shorts-controls {
        bottom: 80px;
    }
}

@media (max-width: 480px) {
    .shorts-container {
        height: calc(100vh - 140px);
    }
    
    .shorts-card {
        min-height: 70vh;
    }
    
    .shorts-title {
        font-size: 14px;
    }
    
    .shorts-channel {
        font-size: 12px;
    }
    
    .shorts-controls {
        bottom: 60px;
        gap: 12px;
    }
    
    .shorts-control-btn {
        width: 36px;
        height: 36px;
        font-size: 14px;
    }
}

/* Portrait mode optimization */
@media (orientation: portrait) {
    .shorts-card {
        min-height: 85vh;
    }
}

/* Landscape mode optimization */
@media (orientation: landscape) {
    .shorts-card {
        min-height: 90vh;
    }
    
    .shorts-controls {
        right: 24px;
        bottom: 120px;
    }
}

/* Prevent scrolling on body when shorts are open */
body.shorts-open {
    overflow: hidden;
}


.shorts-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 16px;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    color: white;
    z-index: 2;
}

.shorts-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.shorts-channel {
    font-size: 14px;
    color: var(--text-secondary);
}

.shorts-controls {
    position: absolute;
    right: 16px;
    bottom: 80px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    z-index: 3;
}

.shorts-control-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    cursor: pointer;
    transition: var(--transition);
}

.shorts-control-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: scale(1.1);
}

/* Auto-play indicator */
.shorts-autoplay {
    position: absolute;
    top: 16px;
    right: 16px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    z-index: 3;
}

.shorts-control-btn.active i {
    color: #ff0000; /* Red heart when liked */
}

.premium-modal {
    background: linear-gradient(145deg, #2a2a32, #1a1a22);
    border: 2px solid var(--primary);
    box-shadow: 0 10px 30px rgba(138, 43, 226, 0.5);
    padding: 30px;
    border-radius: 20px;
    animation: fadeInPremium 0.5s ease;
}

.premium-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.app-name {
    font-size: 28px;
    font-weight: 800;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 0 0 10px var(--glow);
}

.premium-badge {
    background: var(--primary);
    color: white;
    padding: 5px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    animation: pulse 1.5s infinite;
}

.premium-blurb {
    font-size: 16px;
    line-height: 1.6;
    color: var(--text);
    text-align: center;
    margin-bottom: 20px;
}

.app-version {
    text-align: center;
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 400;
}

body.light-mode .premium-modal {
    background: linear-gradient(145deg, #ffffff, #e0e0e0);
    border: 2px solid var(--primary);
}

body.light-mode .premium-blurb {
    color: var(--text);
}

body.light-mode .app-version {
    color: var(--text-secondary);
}

@keyframes fadeInPremium {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}


.auth-cta {
    text-align: center;
    margin-bottom: 20px;
}

.auth-cta h3 {
    font-size: 22px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 8px;
}

//For the sigin and login modal CTA<div></div>
.auth-cta p {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
}

body.light-mode .auth-cta h3 {
    color: var(--primary);
}

body.light-mode .auth-cta p {
    color: var(--text-secondary);
}
    </style>
</head>
<body>
     
   <div class="search-container">
    <div class="search-wrapper">
        <button id="reloadBtn" class="reload-btn">
            <i class="fas fa-sync-alt"></i>
        </button>
        <input
            type="text"
            id="search"
            placeholder="Discover trailers, movies, anime..."
        >
        <button id="searchBtn"><i class="fas fa-search"></i></button>
        <div class="search-history" id="searchHistoryList"></div>
    </div>
</div>

    <div id="explorePage" class="page active">
        <div id="exploreCarousel"></div>
        <div class="content" id="exploreContent">
            <div id="forYouSection" style="display: none;">
                <h2 class="section-title">For You</h2>
                <div class="results-container" id="forYouResults"></div>
            </div>
            <div id="trailerSection">
                <h2 class="section-title">Top Trailers</h2>
                <div class="results-container" id="trailerResults"></div>
            </div>
            <div id="moviesSection">
                <h2 class="section-title">Top Movies</h2>
                <div class="results-container" id="moviesResults"></div>
            </div>
            <div id="animeSection">
                <h2 class="section-title">Top Anime</h2>
                <div class="results-container" id="animeResults"></div>
            </div>
        </div>
        <div class="results-container" id="searchResults" style="display: none;"></div>
    </div>

   <div id="shortsPage" class="page">
    <div class="content" id="shortsContent">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 class="section-title">Shorts For You</h2>
            <button id="refreshShorts" class="reload-btn" style="margin: 0;">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
        <div class="shorts-container" id="shortsResults"></div>
    </div>
</div>

 <!-- Me Page -->
<div id="mePage" class="page">
    <div class="profile-header">
        <div class="profile-banner"></div>
        <div class="profile-avatar-container">
            <div class="profile-avatar">
                <img id="userAvatarImg" src="https://via.placeholder.com/100" alt="User Avatar">
                <div class="avatar-glow"></div>
            </div>
            <h3 id="userProfileName">Guest User</h3>
            <p id="userStatus">Basic Member</p>
        </div>
        <button class="edit-profile-btn" id="editProfileBtn">Edit Profile</button>
    </div>
    <div class="me-content">
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-history"></i>
                <h4>Watch History</h4>
                <p><span id="meWatchHistoryCount">0</span> Videos</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-search"></i>
                <h4>Search History</h4>
                <p><span id="meSearchHistoryCount">0</span> Searches</p>
            </div>
        </div>
        <div class="settings-grid">
            <div class="settings-item" id="accountBtn">
                <i class="fas fa-user-circle"></i>
                <span>Account</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="themeBtn">
                <i class="fas fa-adjust"></i>
                <span>Switch Theme</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="aboutBtn">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
    </div>
</div>

    <div class="pagination-container" id="explorePagination" style="display: none;">
        <div class="pagination">
            <button id="explorePrevBtn" onclick="prevPage()"><i class="fas fa-chevron-left"></i> Previous</button>
            <button id="exploreNextBtn" onclick="nextPage()">Next <i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <!-- Bottom Navigation -->
<div class="bottom-nav">
    <a href="#" class="nav-item" data-page="shortsPage">
        <i class="fas fa-video"></i>
        <span>Shorts</span>
    </a>
    <a href="#" class="nav-item active" data-page="explorePage">
        <i class="fas fa-compass"></i>
        <span>Explore</span>
    </a>
    <a href="downloads.html" class="nav-item">
        <i class="fas fa-download"></i>
        <span>Download</span>
    </a>
    <a href="#" class="nav-item" data-page="mePage">
        <i class="fas fa-user"></i>
        <span>Me</span>
    </a>
</div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <div class="error-message" id="errorMessage"></div>

   <!-- Auth Modal -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <div class="auth-cta">
            <h3 id="authModalTitle">Join TUBE TRAILER Today!</h3>
            <p id="authModalBlurb">Unlock personalized content and premium features.</p>
        </div>
        <form id="authForm">
            <input type="email" class="modal-input" id="authEmail" placeholder="Email" required>
            <input type="password" class="modal-input" id="authPassword" placeholder="Password" required>
            <select class="modal-input" id="contentPreferences" name="contentPreferences" required>
                <option value="" disabled selected>Select your favorite content type</option>
                <option value="action">Action</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="horror">Horror</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="romance">Romance</option>
                <option value="thriller">Thriller</option>
                <option value="fantasy">Fantasy</option>
                <option value="adventure">Adventure</option>
                <option value="animation">Animation</option>
                <option value="documentary">Documentary</option>
                <option value="anime">Anime</option>
                <option value="music">Music</option>
                <option value="gaming">Gaming</option>
                <option value="vlogs">Vlogs</option>
                <option value="tutorials">Tutorials</option>
                <option value="cooking">Cooking</option>
                <option value="sports">Sports</option>
            </select>
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" id="cancelAuthBtn">Cancel</button>
                <button type="button" class="modal-btn secondary" id="toggleAuthBtn">Switch to <span id="authToggleText">Login</span></button>
                <button type="submit" class="modal-btn primary" id="authSubmitBtn">Sign Up</button>
            </div>
        </form>
        <p id="authError" style="color: #ff4757; display: none; margin-top: 10px;"></p>
    </div>
</div>

<div id="accountModal" class="modal">
    <div class="modal-content">
        <h2>Account Settings</h2>
        <form id="accountForm">
            <select class="modal-input" id="accountContentPreferences" required>
                <option value="" disabled>Select your favorite content type</option>
                <option value="action">Action</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="horror">Horror</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="romance">Romance</option>
                <option value="thriller">Thriller</option>
                <option value="fantasy">Fantasy</option>
                <option value="adventure">Adventure</option>
                <option value="animation">Animation</option>
                <option value="documentary">Documentary</option>
                <option value="anime">Anime</option>
                <option value="music">Music</option>
                <option value="gaming">Gaming</option>
                <option value="vlogs">Vlogs</option>
                <option value="tutorials">Tutorials</option>
                <option value="cooking">Cooking</option>
                <option value="sports">Sports</option>
            </select>
            <div class="modal-actions">
                <button type="submit" class="modal-btn primary" id="saveAccountBtn">Save</button>
                <button type="button" class="modal-btn secondary" id="cancelAccountBtn">Cancel</button>
                <button type="button" class="modal-btn secondary" id="signOutBtn">Sign Out</button>
            </div>
        </form>
    </div>
</div>

   <!-- Notification Modal -->
<div id="notificationModal" class="modal">
    <div class="modal-content">
        <span id="closeNotificationBtn" class="close-btn">×</span>
        <h2>Notifications</h2>
        <ul class="notification-list">
            <li><strong>Update:</strong> 250+ Movies added.</li>
            <li><strong>New:</strong> Explore tab now supports all content types.</li>
            <li><strong>Tip:</strong> Instant Download is coming soon.</li>
        </ul>
    </div>
</div>

    <div id="aboutModal" class="modal">
    <div class="modal-content premium-modal">
        <span class="close-btn" onclick="hideAboutModal()">×</span>
        <div class="premium-header">
            <h1 class="app-name">TUBE TRAILER</h1>
            <span class="premium-badge">Premium</span>
        </div>
        <p class="premium-blurb">
            Experience the ultimate entertainment hub with TUBE TRAILER Premium. 
            Dive into a curated world of trending trailers, full-length movies, 
            and exclusive anime, personalized to your tastes. Enjoy seamless 
            streaming, offline downloads, and a sleek, ad-free interface designed 
           just for you!.
        </p>
        <div class="app-version">
            <span>Version 1.2.3</span>
        </div>
    </div>
</div>


<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut as firebaseSignOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDFnJwljFcRLcvyfkMCZOtJsabPQAzyXz4",
        authDomain: "tubetrailer.firebaseapp.com",
        projectId: "tubetrailer",
        storageBucket: "tubetrailer.firebasestorage.app",
        messagingSenderId: "935645040633",
        appId: "1:935645040633:web:0cc787b288158f66213728"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const apiKeys = ["AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc",
    "AIzaSyC_syRSRRxQR1DbtHZzMw9glxcR7My8ly4",

"AIzaSyABi7KdpAijF9gu09dSefpXJyhjIRY66Eg",
            "AIzaSyAqLty-6vku33b3bpdG5S4oLkyoimdw8TU",
            "AIzaSyBYixFCdGHJ2P512iW010glQRvd93EB6O8",
            "AIzaSyDLW2mkmVVgQcoUpM86VFtOaCegFvyVk_g",
            "AIzaSyDe7rOrqZFH3vIqP9zBtNkQ0Lqz4mBz9BI",
            "AIzaSyDFH66idOZwfx-PfO1AXdsUeCa2gV1kCk4",

"AIzaSyAlbWmxyzhL2RaNPNlPsANzY7R0JZUj_TU",

"AIzaSyC4WKW6-m7RlZyu6EctRsN9XjiOz5Z7GWk",

"AIzaSyDSBtLwMoliYaFW09BnVyzTQADrGABHzKw",
"AIzaSyCME7E2t1cd8JTwpXIgDSyAwVMja2QHkL8",

"AIzaSyDdrHGuGB5IKzv6_h7Dkgc60magvKu7YRI",

"AIzaSyDKnfDW7ujsfEFFGV3kWxsmQg9DDtRAUTM",

"AIzaSyC7v1svD5oJFa9Sg4aXFvatOMiwKB2EG2A",

"AIzaSyBS1tt0v9_lLc5HAIAFMkTYbRzVUL27yI0",

"AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc"];
    let currentKeyIndex = 0;

    let exploreCurrentPage = 0;
    let exploreTotalResults = [];
    const resultsPerPage = 26;



    let trailerResults = [];
    let movieResults = [];
    let animeResults = [];

    let isSignUpMode = true;

    function getApiKey() {
        return apiKeys[currentKeyIndex];
    }

    function switchApiKey() {
        currentKeyIndex = (currentKeyIndex + 1) % apiKeys.length;
        console.log(`Switched to API key ${currentKeyIndex + 1}`);
        if (currentKeyIndex === 0) {
            showError("All API keys exhausted. Please try again later.");
            throw new Error("API key quota exhausted");
        }
    }
//Event Listener for short search
document.getElementById('refreshShorts').addEventListener('click', fetchShortsContent);


    function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }

    function showAuthError(message) {
        const errorElement = document.getElementById('authError');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }

function saveToCache(key, data) {
    const cacheEntry = {
        data,
        timestamp: new Date().toISOString()
    };
    localStorage.setItem(key, JSON.stringify(cacheEntry));
}

function loadFromCache(key, maxAgeHours = 24) {
    const cacheEntry = JSON.parse(localStorage.getItem(key));
    if (!cacheEntry || !cacheEntry.timestamp || !cacheEntry.data) return null;

    const cacheTime = new Date(cacheEntry.timestamp);
    const now = new Date();
    const hoursDiff = (now - cacheTime) / (1000 * 60 * 60);

    if (hoursDiff > maxAgeHours) {
        localStorage.removeItem(key); // Clear expired cache
        return null;
    }
    return cacheEntry.data;
}


    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");
    }

    function showSearchHistory() {
        const history = JSON.parse(localStorage.getItem('searchHistory')) || [];
        const list = document.getElementById('searchHistoryList');
        const displayItems = history.slice(0, 10);

        list.innerHTML = '';
        displayItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'search-history-item';
            div.textContent = item.query;
            div.onclick = () => {
                document.getElementById('search').value = item.query;
                list.style.display = 'none';
                searchContent();
            };
            list.appendChild(div);
        });

        if (displayItems.length > 0) {
            list.style.display = 'block';
        }
    }

    function hideSearchHistory() {
        setTimeout(() => {
            document.getElementById('searchHistoryList').style.display = 'none';
        }, 150);
    }

    function filterSearchHistory() {
        const input = document.getElementById('search').value.toLowerCase();
        const allItems = document.querySelectorAll('.search-history-item');

        allItems.forEach(item => {
            item.style.display = item.textContent.toLowerCase().includes(input) ? 'block' : 'none';
        });
    }

    function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');

    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === pageId) {
            item.classList.add('active');
        }
    });

    // Hide search bar on Me & Shorts pages
    const searchBar = document.querySelector('.search-container');
    if (pageId === 'mePage' || pageId === 'shortsPage') {
        searchBar.style.display = 'none';
    } else {
        searchBar.style.display = 'flex';
    }

    // Load content when switching tabs
    if (pageId === 'explorePage') {
        const cachedTrailerResults = loadFromCache('cachedTrailerResults') || [];
        const cachedMovieResults = loadFromCache('cachedMovieResults') || [];
        const cachedAnimeResults = loadFromCache('cachedAnimeResults') || [];
        if (cachedTrailerResults.length > 0 && cachedMovieResults.length > 0 && cachedAnimeResults.length > 0) {
            console.log('Loading cached explore results from localStorage for explore page:', {
                trailerResults: cachedTrailerResults.length + ' items',
                movieResults: cachedMovieResults.length + ' items',
                animeResults: cachedAnimeResults.length + ' items'
            });
            trailerResults = cachedTrailerResults;
            movieResults = cachedMovieResults;
            animeResults = cachedAnimeResults;
            displayExploreContent();
            createExploreCarousel();
            fetchForYouContent();
        } else {
            console.log('No valid cached explore results found or cache expired for explore page. Fetching new content.');
            fetchExploreContent();
        }
    } else if (pageId === 'shortsPage') {
        document.body.classList.add('shorts-open');
        fetchShortsContent();
    } else {
        document.body.classList.remove('shorts-open');
    }

    // Hide pagination on non-explore pages
    document.querySelectorAll('.pagination-container').forEach(p => {
        p.style.display = pageId === 'explorePage' ? 'flex' : 'none';
    });
}


    async function fetchExploreContent() {
    showLoading(true);
    try {
        const trailerResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=latest+movie+trailers&type=video&key=${getApiKey()}`);
        const trailerData = await trailerResponse.json();
        if (trailerData.error) {
            if (trailerData.error.code === 403) {
                switchApiKey();
                return fetchExploreContent();
            }
            throw new Error(trailerData.error.message);
        }
        trailerResults = sortItemsByPublishedDate(trailerData.items || []);

        const movieResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=latest+full+movie+-trailer&type=video&key=${getApiKey()}`);
        const movieData = await movieResponse.json();
        if (movieData.error) {
            if (movieData.error.code === 403) {
                switchApiKey();
                return fetchExploreContent();
            }
            throw new Error(movieData.error.message);
        }
        const movieVideoIds = movieData.items.map(item => item.id.videoId).join(',');
        const movieDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${movieVideoIds}&key=${getApiKey()}`);
        const movieDetailsData = await movieDetailsResponse.json();
        const fullMovies = movieData.items.map(item => ({
            ...item,
            contentDetails: movieDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));
        movieResults = sortItemsByPublishedDate(fullMovies.filter(isFullLengthVideo));

        const animeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=latest+anime+trailer+OR+full+movie+-review&type=video&key=${getApiKey()}`);
        const animeData = await animeResponse.json();
        if (animeData.error) {
            if (animeData.error.code === 403) {
                switchApiKey();
                return fetchExploreContent();
            }
            throw new Error(animeData.error.message);
        }
        const animeVideoIds = animeData.items.map(item => item.id.videoId).join(',');
        const animeDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${animeVideoIds}&key=${getApiKey()}`);
        const animeDetailsData = await animeDetailsResponse.json();
        const fullAnime = animeData.items.map(item => ({
            ...item,
            contentDetails: animeDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));
        animeResults = sortItemsByPublishedDate(fullAnime.filter(video => isFullLengthVideo(video) && isAnimeRelated(video)));

        // Cache the results with timestamp
        saveToCache('cachedTrailerResults', trailerResults);
        saveToCache('cachedMovieResults', movieResults);
        saveToCache('cachedAnimeResults', animeResults);

        displayExploreContent();
        createExploreCarousel();
        fetchForYouContent();
    } catch (error) {
        showError(`Failed to load content: ${error.message}`);
    } finally {
        showLoading(false);
    }
}

    function createExploreCarousel() {
        const carouselItems = [
            ...trailerResults.slice(0, 4),
            ...movieResults.slice(0, 4),
            ...animeResults.slice(0, 4)
        ].sort(() => Math.random() - 0.5).slice(0, 12);
        createCarousel('exploreCarousel', carouselItems);
    }

    function createCarousel(containerId, items) {
        const container = document.getElementById(containerId);
        if (!container || !items || items.length === 0) return;

        container.innerHTML = `
            <div class="carousel-container">
                <div class="carousel-track" id="${containerId}-track"></div>
                <div class="carousel-nav carousel-prev" onclick="moveCarousel('${containerId}', -1)">
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="carousel-nav carousel-next" onclick="moveCarousel('${containerId}', 1)">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        `;

        const track = document.getElementById(`${containerId}-track`);
        items.forEach(item => {
            const carouselItem = document.createElement('div');
            carouselItem.className = 'carousel-item';
            carouselItem.innerHTML = `
                <div class="card">
                    <img src="${item.snippet.thumbnails.medium.url}" class="thumbnail"
                         data-video-id="${item.id.videoId}"
                         data-title="${escapeHtml(item.snippet.title)}"
                         data-thumbnail="${item.snippet.thumbnails.medium.url}">
                    <div class="carousel-overlay">
                        <h3>${escapeHtml(item.snippet.title)}</h3>
                        <p>${escapeHtml(item.snippet.channelTitle)}</p>
                    </div>
                </div>
            `;
            track.appendChild(carouselItem);
        });

        track.querySelectorAll('.thumbnail').forEach(thumbnail => {
            thumbnail.addEventListener('click', () => {
                const videoId = thumbnail.dataset.videoId;
                const title = thumbnail.dataset.title;
                const thumbnailUrl = thumbnail.dataset.thumbnail;
                playVideo(videoId, title, thumbnailUrl);
            });
        });

        startAutoScroll(containerId);
    }

    let carouselIntervals = {};

    function startAutoScroll(containerId) {
        if (carouselIntervals[containerId]) {
            clearInterval(carouselIntervals[containerId]);
        }

        carouselIntervals[containerId] = setInterval(() => {
            moveCarousel(containerId, 1);
        }, 5000);
    }

    function moveCarousel(containerId, direction) {
        const track = document.getElementById(`${containerId}-track`);
        if (!track) return;

        const items = track.querySelectorAll('.carousel-item');
        if (items.length === 0) return;

        const itemWidth = items[0].offsetWidth + 20;
        const currentPosition = track.style.transform ?
            parseInt(track.style.transform.split('(')[1].split('px')[0]) : 0;

        let newPosition = currentPosition - (itemWidth * direction);
        const maxPosition = -(itemWidth * (items.length - 4));

        if (newPosition > 0) {
            newPosition = maxPosition;
        } else if (newPosition < maxPosition) {
            newPosition = 0;
        }

        track.style.transform = `translateX(${newPosition}px)`;
        startAutoScroll(containerId);
    }

    function displayExploreContent() {
        const trailerDiv = document.getElementById('trailerResults');
        const movieDiv = document.getElementById('moviesResults');
        const animeDiv = document.getElementById('animeResults');

        trailerDiv.innerHTML = '';
        movieDiv.innerHTML = '';
        animeDiv.innerHTML = '';

        if (trailerResults.length === 0) {
            trailerDiv.innerHTML = `<div class="empty-state"><i class="fas fa-film"></i><p>No trailers found</p></div>`;
        } else {
            trailerResults.slice(0, 8).forEach((video, index) => {
                trailerDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        if (movieResults.length === 0) {
            movieDiv.innerHTML = `<div class="empty-state"><i class="fas fa-video"></i><p>No movies found</p></div>`;
        } else {
            movieResults.slice(0, 8).forEach((video, index) => {
                movieDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        if (animeResults.length === 0) {
            animeDiv.innerHTML = `<div class="empty-state"><i class="fas fa-dragon"></i><p>No anime found</p></div>`;
        } else {
            animeResults.slice(0, 8).forEach((video, index) => {
                animeDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        document.getElementById('explorePagination').style.display = 'none';
    }

    function generateVideoCard(video, isTrending = false) {
    
        const card = document.createElement('div');
        card.className = 'card';

        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const isFavorited = favorites.some(fav => fav.videoId === video.id.videoId);

        card.innerHTML = `
            ${isTrending ? '<span class="trending-badge">Trending</span>' : ''}
            <button class="favorite-btn ${isFavorited ? 'active' : ''}"
                    data-video-id="${video.id.videoId}"
                    data-title="${escapeHtml(video.snippet.title)}"
                    data-thumbnail="${video.snippet.thumbnails.medium.url}">
                <i class="fas fa-heart"></i>
            </button>
            <img src="${video.snippet.thumbnails.medium.url}" class="thumbnail"
                 data-video-id="${video.id.videoId}"
                 data-title="${escapeHtml(video.snippet.title)}"
                 data-thumbnail="${video.snippet.thumbnails.medium.url}">
            <div class="card-content">
                <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                <div class="channel">${escapeHtml(video.snippet.channelTitle)}</div>
                <div class="card-stats">
                    <div class="views-count">
                        <i class="fas fa-eye"></i> ${Math.floor(Math.random() * 10000000).toLocaleString()}
                    </div>
                    <div class="likes-count">
                        <i class="fas fa-heart"></i> ${Math.floor(Math.random() * 500000).toLocaleString()}
                    </div>
                </div>
            </div>
        `;

        card.querySelector('.thumbnail').addEventListener('click', () => {
            playVideo(video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
        });
        card.querySelector('.favorite-btn').addEventListener('click', (e) => {
            toggleFavorite(e, video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
        });

        return card;
    }

    function toggleFavorite(event, videoId, title, thumbnail) {
        event.stopPropagation();

        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const favIndex = favorites.findIndex(fav => fav.videoId === videoId);
        const button = event.target.closest('.favorite-btn');

        if (favIndex === -1) {
            favorites.push({ videoId, title, thumbnail, date: new Date().toISOString() });
            button.classList.add('active');
            showToast('Added to favorites!');
        } else {
            favorites.splice(favIndex, 1);
            button.classList.remove('active');
            showToast('Removed from favorites!');
        }

        localStorage.setItem('favorites', JSON.stringify(favorites));

        if (document.getElementById('mePage').classList.contains('active')) {
            updateMeTabStats();
        }
    }

    async function fetchForYouContent() {
        const user = auth.currentUser;
        if (!user) return;

        const preferences = JSON.parse(localStorage.getItem('userPreferences'));
        if (!preferences || !preferences.contentType) return;

        showLoading(true);
        try {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(preferences.contentType + ' trailer OR full movie')}&type=video&key=${getApiKey()}`);
            const data = await response.json();
            if (data.error) {
                if (data.error.code === 403) {
                    switchApiKey();
                    return fetchForYouContent();
                }
                throw new Error(data.error.message);
            }

            const forYouDiv = document.getElementById('forYouResults');
            forYouDiv.innerHTML = '';
            document.getElementById('forYouSection').style.display = 'block';

            data.items.forEach((video, index) => {
                forYouDiv.appendChild(generateVideoCard(video, index < 3));
            });
        } catch (error) {
            showError(`Failed to load For You content: ${error.message}`);
            console.error('Error fetching For You:', error);
        } finally {
            showLoading(false);
        }
    }

    async function searchContent() {
    const query = document.getElementById('search').value.trim();
    if (!query) return;

    saveToHistory(query, "");
    let searches = JSON.parse(localStorage.getItem('searchCount')) || 0;
    searches += 1;
    localStorage.setItem('searchCount', JSON.stringify(searches));

    if (document.getElementById('mePage').classList.contains('active')) {
        updateMeTabStats();
    }

    showLoading(true);
    try {
        const trailerResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query + ' trailer')}&type=video&key=${getApiKey()}`);
        const trailerData = await trailerResponse.json();
        if (trailerData.error) {
            if (trailerData.error.code === 403) {
                switchApiKey();
                return searchContent();
            }
            throw new Error(trailerData.error.message);
        }

        const movieResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query + ' full movie -trailer')}&type=video&videoDuration=long&key=${getApiKey()}`);
        const movieData = await movieResponse.json();
        if (movieData.error) {
            if (movieData.error.code === 403) {
                switchApiKey();
                return searchContent();
            }
            throw new Error(movieData.error.message);
        }

        const animeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query + ' anime trailer OR full movie')}&type=video&key=${getApiKey()}`);
        const animeData = await animeResponse.json();
        if (animeData.error) {
            if (animeData.error.code === 403) {
                switchApiKey();
                return searchContent();
            }
            throw new Error(animeData.error.message);
        }

        const movieVideoIds = movieData.items.map(item => item.id.videoId).join(',');
        const movieDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${movieVideoIds}&key=${getApiKey()}`);
        const movieDetailsData = await movieDetailsResponse.json();
        const fullMovies = movieData.items.map(item => ({
            ...item,
            contentDetails: movieDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));

        const animeVideoIds = animeData.items.map(item => item.id.videoId).join(',');
        const animeDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${animeVideoIds}&key=${getApiKey()}`);
        const animeDetailsData = await animeDetailsResponse.json();
        const fullAnime = animeData.items.map(item => ({
            ...item,
            contentDetails: animeDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));

        exploreTotalResults = [
            ...trailerData.items,
            ...fullMovies.filter(isFullLengthVideo),
            ...fullAnime.filter(video => isFullLengthVideo(video) && isAnimeRelated(video))
        ].sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));

        // Cache search results with timestamp
        saveToCache('cachedSearchResults', exploreTotalResults);
        saveToCache('cachedSearchPage', exploreCurrentPage);

        exploreCurrentPage = 0;
        displaySearchResults();
        updatePagination();
        saveToHistory(query, exploreTotalResults[0]?.snippet?.thumbnails?.medium?.url || '');
    } catch (error) {
        showError(`Failed to search: ${error.message}`);
        console.error('Search error:', error);
    } finally {
        showLoading(false);
    }
}

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            searchContent();
        }
    }

    function displaySearchResults() {
        const searchDiv = document.getElementById('searchResults');
        const contentDiv = document.getElementById('exploreContent');
        searchDiv.innerHTML = '';

        if (exploreTotalResults.length === 0) {
            searchDiv.innerHTML = `<div class="empty-state"><i class="fas fa-compass"></i><p>No results found</p></div>`;
            contentDiv.style.display = 'none';
            searchDiv.style.display = 'block';
            document.getElementById('explorePagination').style.display = 'none';
            return;
        }

        contentDiv.style.display = 'none';
        searchDiv.style.display = 'block';

        const start = exploreCurrentPage * resultsPerPage;
        const end = start + resultsPerPage;
        const videos = exploreTotalResults.slice(start, end);

        videos.forEach((video, index) => {
            searchDiv.appendChild(generateVideoCard(video, index < 3));
        });

        document.getElementById('explorePagination').style.display = 'flex';
    }

    function updatePagination() {
        document.getElementById('explorePrevBtn').disabled = exploreCurrentPage === 0;
        document.getElementById('exploreNextBtn').disabled = (exploreCurrentPage + 1) * resultsPerPage >= exploreTotalResults.length;
    }

    function prevPage() {
        if (exploreCurrentPage > 0) {
            exploreCurrentPage--;
            displaySearchResults();
            updatePagination();
        }
    }

    function nextPage() {
        if ((exploreCurrentPage + 1) * resultsPerPage < exploreTotalResults.length) {
            exploreCurrentPage++;
            displaySearchResults();
            updatePagination();
        }
    }

    function isFullLengthVideo(video) {
        const duration = video.contentDetails?.duration;
        if (!duration) return false;

        const regex = /PT(\d+H)?(\d+M)?(\d+S)?/;
        const matches = duration.match(regex);
        if (!matches) return false;

        const hours = parseInt(matches[1]) || 0;
        const minutes = parseInt(matches[2]) || 0;
        const seconds = parseInt(matches[3]) || 0;
        const totalSeconds = hours * 3600 + minutes * 60 + seconds;

        return totalSeconds >= 60;
    }

    function isAnimeRelated(video) {
        const title = video.snippet.title?.toLowerCase() || '';
        const description = video.snippet.description?.toLowerCase() || '';

        const animeKeywords = [
            'anime', 'episode', 'series', 'season', 'part', 'opening', 'ending',
            'dub', 'sub', 'subbed', 'dubbed', 'watch online', 'full episode',
            'naruto', 'one piece', 'bleach', 'attack on titan',
            'my hero', 'boku no hero', 'mha', 'demon slayer', 'tokyo ghoul', 'dragon ball',
            'sailor moon', 'cowboy bebop', 'code geass', 'death note', 'evangelion',
            'pokemon', 'dbz', 'goku', 'luffy', 'eren', 'levi', 'itachi', 'madara',
            'shonen', 'shoujo', 'isekai', 'mecha', 'fantasy', 'adventure', 'action',
            'comedy', 'romance', 'slice of life', 'ecchi', 'harem', 'school', 'horror',
            'crunchyroll', 'funimation', 'animelab', 'neon genesis', 'myanimelist',
            'aniplex', 'madhouse', 'ufotable', 'bones', 'studio pierrot'
        ];

        return animeKeywords.some(kw => title.includes(kw) || description.includes(kw));
    }

    function sortItemsByPublishedDate(items) {
        return items.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
    }

 function playVideo(videoId, title, thumbnail) {
    // If this is a short, open in fallback player
    const isShort = document.querySelector(`.shorts-card[data-video-id="${videoId}"]`);
    
    if (isShort) {
        const fallbackWindow = window.open(
            `fallback-player.html?v=${videoId}&shorts=true`,
            '_blank',
            'width=400,height=700'
        );
        
        setTimeout(() => {
            if (!fallbackWindow || fallbackWindow.closed) {
                window.open(
                    `https://www.youtube.com/shorts/${videoId}`,
                    '_blank'
                );
            }
        }, 300);
        return;
    }
    
    // Original playVideo logic for regular videos...
    let watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
    watchHistory.unshift({ videoId, title, thumbnail, date: new Date().toISOString() });
    localStorage.setItem('watchHistory', JSON.stringify(watchHistory));

    const fallbackWindow = window.open(
        `fallback-player.html?v=${videoId}`,
        '_blank',
        'width=900,height=506'
    );

    setTimeout(() => {
        if (!fallbackWindow || fallbackWindow.closed) {
            window.open(
                `https://www.youtube.com/watch?v=${videoId}`,
                '_blank'
            );
        }
    }, 300);
}



function setupShortsObserver() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const videoId = entry.target.dataset.videoId;
            const playerData = shortsPlayers.get(videoId);
            
            if (!playerData) return;

            if (entry.isIntersecting) {
                // Play when visible
                if (!playerData.element.src) {
                    // Use YouTube iframe API for better compatibility
                    playerData.element.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&=1&playsinline=1&controls=0&enablejsapi=1`;
                }
                playerData.element.play()  // Fixed: Changed playerElement to playerData.element
                    .then(() => {
                        currentPlayingShort = videoId;
                    })
                    .catch(e => {
                        console.log("Autoplay failed, trying muted:", e);
                        playerData.element.muted = true;
                        playerData.element.play();
                    });
            } else {
                // Pause when not visible
                playerData.element.pause();
                if (currentPlayingShort === videoId) {
                    currentPlayingShort = null;
                }
            }
        });
    }, {
        threshold: 0.8,
        rootMargin: '0px 0px -10% 0px'
    });

    // Observe all shorts cards
    document.querySelectorAll('.shorts-card').forEach(card => {
        observer.observe(card);
    });
}


// Control functions
function toggleShortMute(btn) {
    const card = btn.closest('.shorts-card');
    const videoId = card.dataset.videoId;
    const playerData = shortsPlayers.get(videoId);

    if (!playerData || !playerData.player) {
        console.error('No player found for video ID:', videoId);
        return;
    }

    const { player } = playerData;

    if (playerData.isMuted) {
        player.unMute();
        playerData.isMuted = false;
        btn.innerHTML = '<i class="fas fa-volume-up"></i>';
    } else {
        player.mute();
        playerData.isMuted = true;
        btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    }
}

// Shorts player management
let currentPlayingShort = null;
const shortsPlayers = new Map();

    function saveToHistory(query, thumbnail) {
        let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
        history = history.filter(item => item.query.toLowerCase() !== query.toLowerCase());
        history.unshift({ query, thumbnail, date: new Date().toISOString() });
        if (history.length > 10) {
            history = history.slice(0, 10);
        }
        localStorage.setItem('searchHistory', JSON.stringify(history));
    }

    function showAuthModal() {
        document.getElementById('authModal').style.display = 'block';
    }

    function closeAuthModal() {
        document.getElementById('authModal').style.display = 'none';
    }

    function toggleAuthMode() {
    isSignUpMode = !isSignUpMode;
    document.getElementById('authModalTitle').textContent = isSignUpMode ? 'Join TUBE TRAILER Today!' : 'Welcome Back!';
    document.getElementById('authModalBlurb').textContent = isSignUpMode ? 'Unlock personalized content and premium features.' : 'Access your personalized content and settings.';
    document.getElementById('authSubmitBtn').textContent = isSignUpMode ? 'Sign Up' : 'Login';
    document.getElementById('authToggleText').textContent = isSignUpMode ? 'Login' : 'Sign Up';
    const contentPreferences = document.getElementById('contentPreferences');
    contentPreferences.style.display = isSignUpMode ? 'block' : 'none';
    contentPreferences.required = isSignUpMode; // Toggle required attribute
    document.getElementById('authError').style.display = 'none';
}

    function showAccountModal() {
    const user = auth.currentUser;
    if (user) {
        const preferences = JSON.parse(localStorage.getItem('userPreferences')) || {};
        const contentSelect = document.getElementById('accountContentPreferences');
        contentSelect.value = preferences.contentType || '';
        document.getElementById('accountModal').style.display = 'block';
    } else {
        showAuthModal();
    }
}



    function closeModal() {
        document.getElementById('accountModal').style.display = 'none';
    }

    async function saveAccount(event) {
    event.preventDefault();
    try {
        const contentType = document.getElementById('accountContentPreferences').value;
        if (!contentType) {
            showError('Please select a content type.');
            return;
        }

        localStorage.setItem('userPreferences', JSON.stringify({ contentType }));
        showNotificationModal('Preferences updated successfully!');
        closeModal();

        // Refresh personalized content
        const currentPage = document.querySelector('.page.active').id;
        if (currentPage === 'explorePage') {
            await fetchForYouContent();
        } else if (currentPage === 'shortsPage') {
            await fetchShortsContent();
        }
    } catch (error) {
        showError(`Error saving preferences: ${error.message}`);
        console.error('Save account error:', error);
    }
}

    function signOut() {
        firebaseSignOut(auth).then(() => {
            localStorage.removeItem('userPreferences');
            document.getElementById('forYouSection').style.display = 'none';
            updateUserStatus();
            showToast('Signed out successfully');
            showAuthModal();
        }).catch(error => {
            showError(`Sign out failed: ${error.message}`);
            console.error('Sign out error:', error);
        });
    }

    function updateUserStatus() {
    const user = auth.currentUser;
    const statusElement = document.getElementById('userStatus');
    const nameElement = document.getElementById('userProfileName');
    const avatarImg = document.getElementById('userAvatarImg');

    if (user && user.email) {
        const emailPrefix = user.email.split('@')[0];
        nameElement.textContent = user.displayName || emailPrefix || 'User';
        statusElement.textContent = 'Premium Member';
        avatarImg.src = user.photoURL || 'https://via.placeholder.com/100';
    } else {
        nameElement.textContent = 'Guest User';
        statusElement.textContent = 'Basic Member';
        avatarImg.src = 'https://via.placeholder.com/100';
    }

    // Update stats in stats-grid
    updateMeTabStats();
}

// Profile header event listeners
document.getElementById('userAvatarImg').addEventListener('click', () => {
    if (auth.currentUser) {
        showAccountModal();
    } else {
        showAuthModal();
    }
});

document.getElementById('editProfileBtn').addEventListener('click', () => {
    if (auth.currentUser) {
        showAccountModal();
    } else {
        showAuthModal();
    }
});

    function setTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.remove('light-mode');
            document.body.classList.add('dark-mode');
            localStorage.setItem('themePreference', 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            document.body.classList.add('light-mode');
            localStorage.setItem('themePreference', 'light');
        }
    }

    function toggleTheme() {
        const isLight = document.body.classList.contains('light-mode');
        setTheme(isLight ? 'dark' : 'light');
        showToast(`Switched to ${isLight ? 'Dark' : 'Light'} Mode`);
    }

    function showNotificationModal() {
        document.getElementById('notificationModal').style.display = 'block';
    }

    function hideNotificationModal() {
        document.getElementById('notificationModal').style.display = 'none';
    }

    function showAboutModal() {
        document.getElementById('aboutModal').style.display = 'block';
    }

    function hideAboutModal() {
    const aboutModal = document.getElementById('aboutModal');
    if (aboutModal) {
        aboutModal.style.display = 'none';
    } else {
        console.warn('About modal element not found');
    }
}

    
    function clearAllCache() {
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('preload-') || key.includes('Trending') || key.includes('Results')) {
                localStorage.removeItem(key);
            }
        });
        location.reload();
    }

    function updateMeTabStats() {
    const watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
    const meWatchHistoryCount = document.getElementById('meWatchHistoryCount');
    if (meWatchHistoryCount) {
        meWatchHistoryCount.textContent = watchHistory.length;
    }

    const searchCount = JSON.parse(localStorage.getItem('searchCount')) || 0;
    const meSearchHistoryCount = document.getElementById('meSearchHistoryCount');
    if (meSearchHistoryCount) {
        meSearchHistoryCount.textContent = searchCount;
    }
}

   /* event listener auth form*/ document.getElementById('authForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('authEmail').value;
    const password = document.getElementById('authPassword').value;
    const preferences = document.getElementById('contentPreferences').value;

    try {
        if (isSignUpMode) {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            console.log('User signed up:', userCredential.user);
            localStorage.setItem('userPreferences', JSON.stringify({ contentType: preferences }));
            showToast('Account created successfully!');
        } else {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            console.log('User logged in:', userCredential.user);
            showToast('Logged in successfully!');
        }
        closeAuthModal();
        updateUserStatus();
        fetchForYouContent();
    } catch (error) {
        console.error('Auth error:', error);
        const errorMessages = {
            'auth/invalid-credential': 'Invalid password or email.',
            'auth/invalid-email': 'Please enter a valid email address.',
            'auth/user-not-found': 'Invalid password or email.',
            'auth/wrong-password': 'Invalid password or email.',
            'auth/email-already-in-use': 'This email is already registered. Please log in.',
            'auth/weak-password': 'Password must be at least 6 characters long.',
            'auth/missing-password': 'Please enter a password.',
            'auth/missing-email': 'Please enter an email address.'
        };
        const customMessage = errorMessages[error.code] || 'An error occurred. Please try again.';
        showAuthError(customMessage);
    }
});
    onAuthStateChanged(auth, (user) => {
        console.log('Auth state changed:', user ? user.email : 'No user');
        updateUserStatus();
        if (user) {
            fetchForYouContent();
        } else {
            showAuthModal();
        }
    });

   //Dom content document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('themePreference') || 'dark';
    setTheme(savedTheme);
    updateUserStatus();

    // Load cached results with expiration check
    const cachedTrailerResults = loadFromCache('cachedTrailerResults') || [];
    const cachedMovieResults = loadFromCache('cachedMovieResults') || [];
    const cachedAnimeResults = loadFromCache('cachedAnimeResults') || [];
    const cachedSearchResults = loadFromCache('cachedSearchResults') || [];
    const cachedSearchPage = loadFromCache('cachedSearchPage') || 0;

    if (cachedTrailerResults.length > 0 && cachedMovieResults.length > 0 && cachedAnimeResults.length > 0) {
        console.log('Loading cached explore results from localStorage:', {
            trailerResults: cachedTrailerResults.length + ' items',
            movieResults: cachedMovieResults.length + ' items',
            animeResults: cachedAnimeResults.length + ' items'
        });
        trailerResults = cachedTrailerResults;
        movieResults = cachedMovieResults;
        animeResults = cachedAnimeResults;
        displayExploreContent();
        createExploreCarousel();
        fetchForYouContent();
    } else {
        console.log('No valid cached explore results found or cache expired. Fetching new content.');
        fetchExploreContent();
    }

    if (cachedSearchResults.length > 0) {
        console.log('Loading cached search results from localStorage:', {
            searchResults: cachedSearchResults.length + ' items',
            searchPage: cachedSearchPage
        });
        exploreTotalResults = cachedSearchResults;
        exploreCurrentPage = cachedSearchPage;
        displaySearchResults();
        updatePagination();
    } else {
        console.log('No valid cached search results found or cache expired.');
    }

    // Search input event listeners
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('focus', showSearchHistory);
    searchInput.addEventListener('blur', hideSearchHistory);
    searchInput.addEventListener('input', filterSearchHistory);
    searchInput.addEventListener('keypress', handleKeyPress);

    // Button event listeners
    document.getElementById('searchBtn').addEventListener('click', searchContent);
    document.getElementById('reloadBtn').addEventListener('click', clearAllCache);

    // Navigation event listeners
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const pageId = item.getAttribute('data-page');
            if (pageId) {
                showPage(pageId);
            }
        });
    });

    // Auth modal event listeners
    document.getElementById('cancelAuthBtn').addEventListener('click', closeAuthModal);
    document.getElementById('toggleAuthBtn').addEventListener('click', toggleAuthMode);

    // Account modal event listeners
    document.getElementById('accountForm').addEventListener('submit', saveAccount);
    document.getElementById('cancelAccountBtn').addEventListener('click', closeModal);
    document.getElementById('signOutBtn').addEventListener('click', signOut);

    // Settings event listeners
    document.getElementById('accountBtn').addEventListener('click', showAccountModal);
    document.getElementById('themeBtn').addEventListener('click', toggleTheme);
    document.getElementById('notificationBtn').addEventListener('click', showNotificationModal);
    document.getElementById('aboutBtn').addEventListener('click', showAboutModal);

    // Notification and About modal event listeners
document.getElementById('closeNotificationBtn').addEventListener('click', hideNotificationModal);
document.getElementById('closeAboutBtn')?.addEventListener('click', hideAboutModal);

    // Modal close on outside click
 window.addEventListener('click', (event) => {
    const authModal = document.getElementById('authModal');
    const accountModal = document.getElementById('accountModal');
    const notificationModal = document.getElementById('notificationModal');
    const aboutModal = document.getElementById('aboutModal');
    if (event.target === authModal) {
        closeAuthModal();
    }
    if (event.target === accountModal) {
        closeModal();
    }
    if (event.target === notificationModal) {
        hideNotificationModal();
    }
    if (event.target === aboutModal) {
        hideAboutModal();
    }
});

    // Persist last search
    const lastSearch = localStorage.getItem('lastSearch');
    if (lastSearch) {
        searchInput.value = lastSearch;
    }
    searchInput.addEventListener('input', (e) => {
        localStorage.setItem('lastSearch', e.target.value);
    });



    async function fetchShortsContent() {
    const user = auth.currentUser;
    if (!user) {
        document.getElementById('shortsResults').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-user-lock"></i>
                <p>Sign in to see personalized Shorts</p>
            </div>
        `;
        return;
    }

    const preferences = JSON.parse(localStorage.getItem('userPreferences'));
    if (!preferences?.contentType) {
        document.getElementById('shortsResults').innerHTML = `
            <div class="empty-state">
                <i class="fas fa-cog"></i>
                <p>Set your preferences in Account Settings</p>
            </div>
        `;
        return;
    }

    showLoading(true);
    try {
        const response = await fetch(
            `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(
                preferences.contentType + ' shorts'
            )}&type=video&videoDuration=short&key=${getApiKey()}`
        );
        const data = await response.json();

        if (data.error) throw data.error;

        const shortsContainer = document.getElementById('shortsResults');
        shortsContainer.innerHTML = '';

        if (data.items?.length > 0) {
            data.items.forEach((video) => {
                shortsContainer.appendChild(generateShortsCard(video));
            });
            
            // Set up observer after shorts are loaded
            setTimeout(setupShortsObserver, 100);
        } else {
            shortsContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-video-slash"></i>
                    <p>No Shorts found for your preferences</p>
                </div>
            `;
        }
    } catch (error) {
        showError(`Failed to load Shorts: ${error.message}`);
    } finally {
        showLoading(false);
    }
}
function generateShortsCard(video) {
    const card = document.createElement('div');
    card.className = 'shorts-card';
    card.dataset.videoId = video.id.videoId;

    card.innerHTML = `
        <iframe class="shorts-player" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <div class="shorts-overlay">
            <div class="shorts-title">${escapeHtml(video.snippet.title)}</div>
            <div class="shorts-channel">${escapeHtml(video.snippet.channelTitle)}</div>
        </div>
        <div class="shorts-controls">
            <button class="shorts-control-btn" onclick="toggleShortMute(this)">
                <i class="fas fa-volume-mute"></i>
            </button>
            <button class="shorts-control-btn" onclick="likeShort(this)">
                <i class="far fa-heart"></i>
            </button>
        </div>
        <div class="shorts-autoplay">Auto-play</div>
    `;

    const player = card.querySelector('.shorts-player');
    
    
    shortsPlayers.set(video.id.videoId, {
        element: player,
        card: card,
        isMuted: true
    });

    card.addEventListener('click', (e) => {
        if (e.target.closest('.shorts-controls')) return;
        playVideo(video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
    });

    return card;
}

</script>

<script src="https://www.youtube.com/iframe_api "></script>

<script>
    let shortsPlayers = new Map(); // Already defined earlier in your code

    
    function onYouTubeIframeAPIReady() {
        document.querySelectorAll('.shorts-card').forEach(card => {
            const videoId = card.dataset.videoId;
            const iframe = card.querySelector('.shorts-player');

            // Create YouTube Player instance
            const player = new YT.Player(iframe, {
                events: {
                    'onReady': () => {
                        console.log('Player ready:', videoId);
                        player.mute(); // Mute by default
                    }
                }
            });

            // Store player reference with mute state
            shortsPlayers.set(videoId, {
                player,
                isMuted: true
            });
        });
    }

function likeShort(btn) {
    const card = btn.closest('.shorts-card');
    const videoId = card.dataset.videoId;

    // Toggle active state
    btn.classList.toggle('active');

    // Optional: Save liked shorts to localStorage
    let likedShorts = JSON.parse(localStorage.getItem('likedShorts')) || [];

    if (btn.classList.contains('active')) {
        if (!likedShorts.includes(videoId)) {
            likedShorts.push(videoId);
        }
        showToast('Liked!');
    } else {
        likedShorts = likedShorts.filter(id => id !== videoId);
        showToast('Unliked');
    }

    localStorage.setItem('likedShorts', JSON.stringify(likedShorts));
}

function showToast(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        `;
        document.body.appendChild(toast);
    }
    toast.textContent = message;
    toast.style.opacity = 1;
    setTimeout(() => {
        toast.style.opacity = 0;
    }, 2000);
}
</script>
</body>
</html>
