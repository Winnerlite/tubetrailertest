<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Movie & Trailer App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8a2be2;
            --primary-dark: #6a1b9a;
            --anime: #e91e63;
            --anime-dark: #c2185b;
            --bg: #0a0a0e;
            --card-bg: linear-gradient(145deg, #1a1a22, #2a2a32);
            --text: #f0f0f0;
            --text-secondary: #b0b0b0;
            --glow: rgba(138, 43, 226, 0.3);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 60px;
            transition: background 0.3s ease;
        }

        body.light-mode {
            --bg: #f5f5f5;
            --card-bg: linear-gradient(145deg, #ffffff, #e0e0e0);
            --text: #333333;
            --text-secondary: #666666;
            --glow: rgba(138, 43, 226, 0.2);
        }

        .search-container {
            height: 60px;
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 14, 0.85);
            backdrop-filter: blur(12px);
            padding: 10px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: var(--transition);
        }

        body.light-mode .search-container {
            background: rgba(245, 245, 245, 0.85);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 600px;
            display: flex;
            align-items: center;
        }

        .search-container input {
            padding: 12px 20px;
            font-size: 16px;
            width: 100%;
            border: 1px solid transparent;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            text-align: left;
            transition: var(--transition);
            box-shadow: 0 0 10px var(--glow);
        }

        .search-container input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--glow);
            background: rgba(255, 255, 255, 0.12);
        }

        body.light-mode .search-container input {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text);
        }

        .search-container input::placeholder {
            color: var(--text-secondary);
            animation: pulse-placeholder 3s infinite;
        }

        @keyframes pulse-placeholder {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .search-container button {
            padding: 12px 20px;
            font-size: 16px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 30px;
            margin-left: 10px;
            transition: var(--transition);
            box-shadow: 0 0 10px var(--glow);
        }

        .search-container button:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .reload-btn {
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 50%;
            margin-right: 10px;
            transition: var(--transition);
        }

        .reload-btn:hover {
            background: var(--primary-dark);
            transform: rotate(90deg);
        }

        .search-history {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 600px;
            background: rgba(26, 26, 34, 0.95);
            border-radius: 15px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
        }

        body.light-mode .search-history {
            background: rgba(255, 255, 255, 0.95);
        }

        .search-history-item {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text);
        }

        .search-history-item:hover {
            background: var(--primary);
            color: white;
        }

        .carousel-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            margin: 0 auto 40px;
            padding: 20px 0;
            background: linear-gradient(180deg, rgba(138, 43, 226, 0.1), transparent);
        }

        .carousel-track {
            display: flex;
            gap: 20px;
            padding: 0 20px;
            transition: transform 0.6s ease;
        }

        .carousel-item {
            flex: 0 0 calc(80% - 20px);
            min-width: 0;
            aspect-ratio: 16/9;
            position: relative;
            transform: perspective(1000px) rotateY(0deg);
            transition: var(--transition);
        }

        .carousel-item:hover {
            transform: perspective(1000px) rotateY(5deg) scale(1.02);
        }

        @media (min-width: 768px) {
            .carousel-item {
                flex: 0 0 calc(50% - 20px);
            }
        }

        @media (min-width: 1024px) {
            .carousel-item {
                flex: 0 0 calc(33.33% - 20px);
            }
        }

        .carousel-item .thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .carousel-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            color: white;
            opacity: 0;
            transition: var(--transition);
        }

        .carousel-item:hover .carousel-overlay {
            opacity: 1;
        }

        .carousel-overlay h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .carousel-overlay p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            color: white;
            font-size: 24px;
            transition: var(--transition);
        }

        .carousel-nav:hover {
            background: var(--primary);
        }

        .carousel-prev {
            left: 10px;
        }

        .carousel-next {
            right: 10px;
        }

        .content {
            margin-top: 20px;
            padding-bottom: 20px;
        }

        .section-title {
            padding: 15px 20px;
            font-size: 24px;
            font-weight: 800;
            position: relative;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #forYouSection .section-title {
            color: var(--anime);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 20px;
            width: 50px;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        #forYouSection .section-title::after {
            background: var(--anime);
        }

        .section-title:hover::after {
            width: 100px;
        }

        body.light-mode .section-title {
            color: var(--text);
        }

        .results-container {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease;
        }

        @media (min-width: 768px) {
            .results-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .results-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            border: 1px solid transparent;
        }

        .card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 12px 24px var(--glow);
            border: 1px solid var(--primary);
        }

        .thumbnail {
            width: 100%;
            height: 220px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .card:hover .thumbnail {
            transform: scale(1.05);
        }

        .card-content {
            padding: 15px;
            background: rgba(0,0,0,0.2);
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.light-mode .video-title {
            color: var(--text);
        }

        .channel {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .views-count {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .likes-count {
            background: rgba(255, 50, 50, 0.3);
            padding: 4px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trending-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 1.5s infinite;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            z-index: 2;
        }

        .favorite-btn.active {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.3);
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn i {
            pointer-events: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pagination-container {
            position: fixed;
            bottom: 70px;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.9);
            padding: 15px 0;
            display: flex;
            justify-content: center;
            z-index: 999;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
            transition: var(--transition);
        }

        body.light-mode .pagination-container {
            background: rgba(245, 245, 245, 0.9);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        }

        .pagination {
            display: flex;
            gap: 15px;
        }

        .pagination button {
            padding: 10px 20px;
            font-size: 14px;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--primary);
            box-shadow: 0 0 10px var(--glow);
        }

        .pagination button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .pagination button:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            z-index: 1001;
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.2);
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(138, 43, 226, 0.9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            z-index: 1001;
            display: none;
            max-width: 80%;
        }

      /* Me Page Styles */
#mePage {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

.profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.profile-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
}

.profile-avatar i {
    font-size: 24px;
    color: var(--text-color);
}

.profile-info h3 {
    margin: 0;
    font-size: 18px;
    color: var(--text-color);
}

.profile-info p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.me-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.stat-card {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.stat-card i {
    font-size: 24px;
    color: var(--primary);
    margin-bottom: 10px;
}

.stat-card h4 {
    margin: 0;
    font-size: 16px;
    color: var(--text-color);
}

.stat-card p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.settings-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.settings-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.settings-item:hover {
    background: var(--hover-bg);
}

.settings-item i:first-child {
    font-size: 20px;
    color: var(--primary);
    margin-right: 10px;
}

.settings-item span {
    flex: 1;
    font-size: 16px;
    color: var(--text-color);
}

.settings-item i:last-child {
    font-size: 16px;
    color: var(--text-secondary);
}

/* Modal Styles (for Account and Notification Modals) */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    width: 90%;
    position: relative;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.modal-content .close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
    color: var(--text-secondary);
}

.modal-content .close:hover {
    color: var(--primary);
}

.modal-content h3 {
    margin: 0 0 15px;
    font-size: 18px;
    color: var(--text-color);
}

.modal-input {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 14px;
}

.modal-actions {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}

.modal-btn.primary {
    background: var(--primary);
    color: white;
}

.modal-btn.secondary {
    background: var(--secondary);
    color: var(--text-color);
}

.modal-btn:hover {
    opacity: 0.9;
}

/* Theme Variables (ensure these are defined) */
:root {
    --primary: #6200ea;
    --secondary: #e0e0e0;
    --card-bg: #ffffff;
    --text-color: #212121;
    --text-secondary: #757575;
    --border-color: #e0e0e0;
    --input-bg: #f5f5f5;
    --hover-bg: #f0f0f0;
}

.dark-mode {
    --card-bg: #424242;
    --text-color: #ffffff;
    --text-secondary: #b0b0b0;
    --border-color: #616161;
    --input-bg: #616161;
    --hover-bg: #616161;
}

        .theme-switcher {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .theme-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: var(--transition);
        }

        .theme-btn.dark {
            background: #333;
            color: white;
        }

        .theme-btn.light {
            background: #f0f0f0;
            color: #333;
        }

        .theme-btn.active {
            outline: 2px solid var(--primary);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        body.light-mode .bottom-nav {
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: 10px;
        }

        .nav-item i {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(138, 43, 226, 0.1);
        }

        .nav-item:hover {
            color: var(--primary);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.6;
        }

        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .search-container input {
                width: 100%;
                font-size: 14px;
                padding: 10px 15px;
            }

            .search-container button {
                font-size: 14px;
                padding: 10px 15px;
            }

            .thumbnail {
                height: 180px;
            }

            .video-title {
                font-size: 14px;
            }

            .channel {
                font-size: 12px;
            }

            .pagination button {
                padding: 8px 15px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .search-container {
                padding: 8px;
            }

            .thumbnail {
                height: 160px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
        }

        .modal-content {
            background: var(--card-bg);
            max-width: 400px;
            margin: 20vh auto;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-input, .modal-input select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            transition: var(--transition);
        }

        body.light-mode .modal-input, body.light-mode .modal-input select {
            background: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        #mePage ~ .pagination-container {
            display: none !important;
        }

        .notification-list {
            text-align: left;
            margin-top: 20px;
            padding-left: 25px;
            color: var(--text-secondary);
        }

        .notification-list li {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .profile-header {
            position: relative;
            margin-bottom: 60px;
        }

        .profile-banner {
            height: 120px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 0 0 15px 15px;
        }

        .profile-avatar-container {
            text-align: center;
            margin-top: -50px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--card-bg);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 3px solid var(--card-bg);
        }

        .profile-avatar i {
            font-size: 40px;
            color: var(--primary);
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: var(--card-bg);
            margin: 0 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 0 20px;
        }

        .settings-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
        }

        .settings-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .settings-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .settings-icon.account {
            background: var(--primary);
        }

        .settings-icon.appearance {
            background: #6a1b9a;
        }

        .settings-icon.notifications {
            background: #e91e63;
        }

        .settings-icon.about {
            background: #2196F3;
        }

        .settings-card h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .settings-card p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        @media (max-width: 480px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            .profile-banner {
                height: 100px;
            }
        }


        /* Shorts Page Styles */
.shorts-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding: 0 10px;
    max-width: 600px;
    margin: 0 auto;
}

.shorts-card {
    background: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
    border: 1px solid transparent;
}

.shorts-card:hover {
    transform: scale(1.02);
    box-shadow: 0 12px 24px var(--glow);
    border: 1px solid var(--primary);
}

.shorts-thumbnail {
    width: 100%;
    aspect-ratio: 9/16;
    object-fit: cover;
    cursor: pointer;
}

.shorts-content {
    padding: 15px;
    background: rgba(0,0,0,0.2);
}

.shorts-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: var(--text-color);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

.shorts-channel {
    font-size: 14px;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

@media (max-width: 480px) {
    .shorts-container {
        padding: 0 5px;
    }
    .shorts-title {
        font-size: 14px;
    }
    .shorts-channel {
        font-size: 12px;
    }
}
    </style>
</head>
<body>
   <div class="search-container">
    <div class="search-wrapper">
        <button id="reloadBtn" class="reload-btn">
            <i class="fas fa-sync-alt"></i>
        </button>
        <input
            type="text"
            id="search"
            placeholder="Discover trailers, movies, anime..."
        >
        <button id="searchBtn"><i class="fas fa-search"></i></button>
        <div class="search-history" id="searchHistoryList"></div>
    </div>
</div>

    <div id="explorePage" class="page active">
        <div id="exploreCarousel"></div>
        <div class="content" id="exploreContent">
            <div id="forYouSection" style="display: none;">
                <h2 class="section-title">For You</h2>
                <div class="results-container" id="forYouResults"></div>
            </div>
            <div id="trailerSection">
                <h2 class="section-title">Top Trailers</h2>
                <div class="results-container" id="trailerResults"></div>
            </div>
            <div id="moviesSection">
                <h2 class="section-title">Top Movies</h2>
                <div class="results-container" id="moviesResults"></div>
            </div>
            <div id="animeSection">
                <h2 class="section-title">Top Anime</h2>
                <div class="results-container" id="animeResults"></div>
            </div>
        </div>
        <div class="results-container" id="searchResults" style="display: none;"></div>
    </div>

    <div id="shortsPage" class="page">
    <div class="content" id="shortsContent">
        <h2 class="section-title">Shorts</h2>
        <div class="shorts-container" id="shortsResults"></div>
    </div>
</div>

 <!-- Me Page -->
<div id="mePage" class="page">
    <div class="profile-header">
        <div class="profile-avatar">
            <i class="fas fa-user"></i>
        </div>
        <div class="profile-info">
            <h3 id="userProfileName">Guest User</h3>
            <p id="userStatus">Basic Member</p>
        </div>
    </div>
    <div class="me-content">
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-history"></i>
                <h4>Watch History</h4>
                <p><span id="watchHistoryCount">0</span> Videos</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-search"></i>
                <h4>Search History</h4>
                <p><span id="searchHistoryCount">0</span> Searches</p>
            </div>
        </div>
        <div class="settings-grid">
            <div class="settings-item" id="accountBtn">
                <i class="fas fa-user-circle"></i>
                <span>Account</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="themeBtn">
                <i class="fas fa-adjust"></i>
                <span>Switch Theme</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="aboutBtn">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
    </div>
</div>

    <div class="pagination-container" id="explorePagination" style="display: none;">
        <div class="pagination">
            <button id="explorePrevBtn" onclick="prevPage()"><i class="fas fa-chevron-left"></i> Previous</button>
            <button id="exploreNextBtn" onclick="nextPage()">Next <i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <!-- Bottom Navigation -->
<div class="bottom-nav">
    <a href="#" class="nav-item" data-page="shortsPage">
        <i class="fas fa-video"></i>
        <span>Shorts</span>
    </a>
    <a href="#" class="nav-item active" data-page="explorePage">
        <i class="fas fa-compass"></i>
        <span>Explore</span>
    </a>
    <a href="downloads.html" class="nav-item">
        <i class="fas fa-download"></i>
        <span>Download</span>
    </a>
    <a href="#" class="nav-item" data-page="mePage">
        <i class="fas fa-user"></i>
        <span>Me</span>
    </a>
</div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <div class="error-message" id="errorMessage"></div>

   <!-- Auth Modal -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <h3 id="authModalTitle">Sign Up</h3>
        <form id="authForm">
            <input type="email" class="modal-input" id="authEmail" placeholder="Email" required>
            <input type="password" class="modal-input" id="authPassword" placeholder="Password" required>
            <select class="modal-input" id="contentPreferences" required>
                <option value="" disabled selected>Select your favorite content type</option>
                <option value="action">Action</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="horror">Horror</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="romance">Romance</option>
                <option value="thriller">Thriller</option>
                <option value="fantasy">Fantasy</option>
                <option value="adventure">Adventure</option>
                <option value="animation">Animation</option>
                <option value="documentary">Documentary</option>
                <option value="anime">Anime</option>
                <option value="music">Music</option>
                <option value="gaming">Gaming</option>
                <option value="vlogs">Vlogs</option>
                <option value="tutorials">Tutorials</option>
                <option value="cooking">Cooking</option>
                <option value="sports">Sports</option>
            </select>
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" id="cancelAuthBtn">Cancel</button>
                <button type="button" class="modal-btn secondary" id="toggleAuthBtn">Switch to <span id="authToggleText">Login</span></button>
                <button type="submit" class="modal-btn primary" id="authSubmitBtn">Sign Up</button>
            </div>
        </form>
        <p id="authError" style="color: #ff4757; display: none; margin-top: 10px;"></p>
    </div>
</div>

<!-- Account Modal -->
<div id="accountModal" class="modal">
    <div class="modal-content">
        <h3>Account</h3>
        <form id="accountForm">
            <input type="text" id="userName" class="modal-input" placeholder="Name">
            <input type="email" id="userEmail" class="modal-input" placeholder="Email">
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" id="cancelAccountBtn">Cancel</button>
                <button type="button" class="modal-btn secondary" id="signOutBtn">Sign Out</button>
                <button type="submit" class="modal-btn primary">Save</button>
            </div>
        </form>
    </div>
</div>

   <!-- Notification Modal -->
<div id="notificationModal" class="modal">
    <div class="modal-content">
        <span id="closeNotificationBtn" class="close-btn">√ó</span>
        <h2>Notifications</h2>
        <ul class="notification-list">
            <li><strong>Update:</strong> 250+ Movies added.</li>
            <li><strong>New:</strong> Explore tab now supports all content types.</li>
            <li><strong>Tip:</strong> Instant Download is coming soon.</li>
        </ul>
    </div>
</div>

    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideAboutModal()">√ó</span>
            <h2>About This App</h2>
            <strong>TUBETRAILER</strong>
            <p>Your gateway to trending trailers, full movies, and anime highlights.</p>
           <h3>Getting Started</h3>
<p>Search any title or keyword in the top bar. Use the bottom navigation to switch between:</p>
<ul>
    <li><p>üìπ <strong>Shorts</strong> - Quick, genre-based videos</li>
    <li><p>üß≠ <strong>Explore</strong> - Trailers, movies, and anime</li>
    <li><p>‚¨áÔ∏è <strong>Download</strong> - Download content</li>
    <li><p>‚öôÔ∏è <strong>Me</strong> - Profile and settings</li>
</ul>
            <h3>Pro Tips</h3>
            <ul>
                <li>üîç <strong>Smart searches:</strong> Add "trailer" or "anime" to queries</li>
                <li>üåì <strong>Dark/Light mode:</strong> Toggle in Appearance settings</li>
                <li>üîÑ <strong>Reload button:</strong> Top-left icon refreshes recommendations</li>
            </ul>
            <h3>What's Next?</h3>
            <p>Coming soon: personalized recommendations, more!!</p>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut as firebaseSignOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDFnJwljFcRLcvyfkMCZOtJsabPQAzyXz4",
        authDomain: "tubetrailer.firebaseapp.com",
        projectId: "tubetrailer",
        storageBucket: "tubetrailer.firebasestorage.app",
        messagingSenderId: "935645040633",
        appId: "1:935645040633:web:0cc787b288158f66213728"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const apiKeys = ["AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc"];
    let currentKeyIndex = 0;

    let exploreCurrentPage = 0;
    let exploreTotalResults = [];
    const resultsPerPage = 26;

    let trailerResults = [];
    let movieResults = [];
    let animeResults = [];

    let isSignUpMode = true;

    function getApiKey() {
        return apiKeys[currentKeyIndex];
    }

    function switchApiKey() {
        currentKeyIndex = (currentKeyIndex + 1) % apiKeys.length;
        console.log(`Switched to API key ${currentKeyIndex + 1}`);
        if (currentKeyIndex === 0) {
            showError("All API keys exhausted. Please try again later.");
            throw new Error("API key quota exhausted");
        }
    }

    function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }

    function showAuthError(message) {
        const errorElement = document.getElementById('authError');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }

    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#39;");
    }

    function showSearchHistory() {
        const history = JSON.parse(localStorage.getItem('searchHistory')) || [];
        const list = document.getElementById('searchHistoryList');
        const displayItems = history.slice(0, 10);

        list.innerHTML = '';
        displayItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'search-history-item';
            div.textContent = item.query;
            div.onclick = () => {
                document.getElementById('search').value = item.query;
                list.style.display = 'none';
                searchContent();
            };
            list.appendChild(div);
        });

        if (displayItems.length > 0) {
            list.style.display = 'block';
        }
    }

    function hideSearchHistory() {
        setTimeout(() => {
            document.getElementById('searchHistoryList').style.display = 'none';
        }, 150);
    }

    function filterSearchHistory() {
        const input = document.getElementById('search').value.toLowerCase();
        const allItems = document.querySelectorAll('.search-history-item');

        allItems.forEach(item => {
            item.style.display = item.textContent.toLowerCase().includes(input) ? 'block' : 'none';
        });
    }

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');

        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('data-page') === pageId) {
                item.classList.add('active');
            }
        });

        const searchBar = document.querySelector('.search-container');
        if (pageId === 'mePage') {
            searchBar.style.display = 'none';
            updateMeTabStats();
        } else {
            searchBar.style.display = 'flex';
        }

        document.querySelectorAll('.pagination-container').forEach(p => {
            p.style.display = pageId === 'mePage' ? 'none' : 'flex';
        });

        if (pageId === 'explorePage' && trailerResults.length === 0) {
            fetchExploreContent();
        }
    }

    async function fetchExploreContent() {
        showLoading(true);
        try {
            const trailerResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=latest+movie+trailers&type=video&key=${getApiKey()}`);
            const trailerData = await trailerResponse.json();
            if (trailerData.error) {
                if (trailerData.error.code === 403) {
                    switchApiKey();
                    return fetchExploreContent();
                }
                throw new Error(trailerData.error.message);
            }
            trailerResults = sortItemsByPublishedDate(trailerData.items || []);

            const movieResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=latest+full+movie+-trailer&type=video&key=${getApiKey()}`);
            const movieData = await movieResponse.json();
            if (movieData.error) {
                if (movieData.error.code === 403) {
                    switchApiKey();
                    return fetchExploreContent();
                }
                throw new Error(movieData.error.message);
            }
            const movieVideoIds = movieData.items.map(item => item.id.videoId).join(',');
            const movieDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${movieVideoIds}&key=${getApiKey()}`);
            const movieDetailsData = await movieDetailsResponse.json();
            const fullMovies = movieData.items.map(item => ({
                ...item,
                contentDetails: movieDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
            }));
            movieResults = sortItemsByPublishedDate(fullMovies.filter(isFullLengthVideo));

            const animeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=latest+anime+trailer+OR+full+movie+-review&type=video&key=${getApiKey()}`);
            const animeData = await animeResponse.json();
            if (animeData.error) {
                if (animeData.error.code === 403) {
                    switchApiKey();
                    return fetchExploreContent();
                }
                throw new Error(animeData.error.message);
            }
            const animeVideoIds = animeData.items.map(item => item.id.videoId).join(',');
            const animeDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${animeVideoIds}&key=${getApiKey()}`);
            const animeDetailsData = await animeDetailsResponse.json();
            const fullAnime = animeData.items.map(item => ({
                ...item,
                contentDetails: animeDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
            }));
            animeResults = sortItemsByPublishedDate(fullAnime.filter(video => isFullLengthVideo(video) && isAnimeRelated(video)));

            displayExploreContent();
            createExploreCarousel();
            fetchForYouContent();
        } catch (error) {
            showError(`Failed to load content: ${error.message}`);
        } finally {
            showLoading(false);
        }
    }

    function createExploreCarousel() {
        const carouselItems = [
            ...trailerResults.slice(0, 4),
            ...movieResults.slice(0, 4),
            ...animeResults.slice(0, 4)
        ].sort(() => Math.random() - 0.5).slice(0, 12);
        createCarousel('exploreCarousel', carouselItems);
    }

    function createCarousel(containerId, items) {
        const container = document.getElementById(containerId);
        if (!container || !items || items.length === 0) return;

        container.innerHTML = `
            <div class="carousel-container">
                <div class="carousel-track" id="${containerId}-track"></div>
                <div class="carousel-nav carousel-prev" onclick="moveCarousel('${containerId}', -1)">
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="carousel-nav carousel-next" onclick="moveCarousel('${containerId}', 1)">
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        `;

        const track = document.getElementById(`${containerId}-track`);
        items.forEach(item => {
            const carouselItem = document.createElement('div');
            carouselItem.className = 'carousel-item';
            carouselItem.innerHTML = `
                <div class="card">
                    <img src="${item.snippet.thumbnails.medium.url}" class="thumbnail"
                         data-video-id="${item.id.videoId}"
                         data-title="${escapeHtml(item.snippet.title)}"
                         data-thumbnail="${item.snippet.thumbnails.medium.url}">
                    <div class="carousel-overlay">
                        <h3>${escapeHtml(item.snippet.title)}</h3>
                        <p>${escapeHtml(item.snippet.channelTitle)}</p>
                    </div>
                </div>
            `;
            track.appendChild(carouselItem);
        });

        track.querySelectorAll('.thumbnail').forEach(thumbnail => {
            thumbnail.addEventListener('click', () => {
                const videoId = thumbnail.dataset.videoId;
                const title = thumbnail.dataset.title;
                const thumbnailUrl = thumbnail.dataset.thumbnail;
                playVideo(videoId, title, thumbnailUrl);
            });
        });

        startAutoScroll(containerId);
    }

    let carouselIntervals = {};

    function startAutoScroll(containerId) {
        if (carouselIntervals[containerId]) {
            clearInterval(carouselIntervals[containerId]);
        }

        carouselIntervals[containerId] = setInterval(() => {
            moveCarousel(containerId, 1);
        }, 5000);
    }

    function moveCarousel(containerId, direction) {
        const track = document.getElementById(`${containerId}-track`);
        if (!track) return;

        const items = track.querySelectorAll('.carousel-item');
        if (items.length === 0) return;

        const itemWidth = items[0].offsetWidth + 20;
        const currentPosition = track.style.transform ?
            parseInt(track.style.transform.split('(')[1].split('px')[0]) : 0;

        let newPosition = currentPosition - (itemWidth * direction);
        const maxPosition = -(itemWidth * (items.length - 4));

        if (newPosition > 0) {
            newPosition = maxPosition;
        } else if (newPosition < maxPosition) {
            newPosition = 0;
        }

        track.style.transform = `translateX(${newPosition}px)`;
        startAutoScroll(containerId);
    }

    function displayExploreContent() {
        const trailerDiv = document.getElementById('trailerResults');
        const movieDiv = document.getElementById('moviesResults');
        const animeDiv = document.getElementById('animeResults');

        trailerDiv.innerHTML = '';
        movieDiv.innerHTML = '';
        animeDiv.innerHTML = '';

        if (trailerResults.length === 0) {
            trailerDiv.innerHTML = `<div class="empty-state"><i class="fas fa-film"></i><p>No trailers found</p></div>`;
        } else {
            trailerResults.slice(0, 8).forEach((video, index) => {
                trailerDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        if (movieResults.length === 0) {
            movieDiv.innerHTML = `<div class="empty-state"><i class="fas fa-video"></i><p>No movies found</p></div>`;
        } else {
            movieResults.slice(0, 8).forEach((video, index) => {
                movieDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        if (animeResults.length === 0) {
            animeDiv.innerHTML = `<div class="empty-state"><i class="fas fa-dragon"></i><p>No anime found</p></div>`;
        } else {
            animeResults.slice(0, 8).forEach((video, index) => {
                animeDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        document.getElementById('explorePagination').style.display = 'none';
    }

    function generateVideoCard(video, isTrending = false) {
        const card = document.createElement('div');
        card.className = 'card';

        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const isFavorited = favorites.some(fav => fav.videoId === video.id.videoId);

        card.innerHTML = `
            ${isTrending ? '<span class="trending-badge">Trending</span>' : ''}
            <button class="favorite-btn ${isFavorited ? 'active' : ''}"
                    data-video-id="${video.id.videoId}"
                    data-title="${escapeHtml(video.snippet.title)}"
                    data-thumbnail="${video.snippet.thumbnails.medium.url}">
                <i class="fas fa-heart"></i>
            </button>
            <img src="${video.snippet.thumbnails.medium.url}" class="thumbnail"
                 data-video-id="${video.id.videoId}"
                 data-title="${escapeHtml(video.snippet.title)}"
                 data-thumbnail="${video.snippet.thumbnails.medium.url}">
            <div class="card-content">
                <div class="video-title">${escapeHtml(video.snippet.title)}</div>
                <div class="channel">${escapeHtml(video.snippet.channelTitle)}</div>
                <div class="card-stats">
                    <div class="views-count">
                        <i class="fas fa-eye"></i> ${Math.floor(Math.random() * 10000000).toLocaleString()}
                    </div>
                    <div class="likes-count">
                        <i class="fas fa-heart"></i> ${Math.floor(Math.random() * 500000).toLocaleString()}
                    </div>
                </div>
            </div>
        `;

        card.querySelector('.thumbnail').addEventListener('click', () => {
            playVideo(video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
        });
        card.querySelector('.favorite-btn').addEventListener('click', (e) => {
            toggleFavorite(e, video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
        });

        return card;
    }

    function toggleFavorite(event, videoId, title, thumbnail) {
        event.stopPropagation();

        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const favIndex = favorites.findIndex(fav => fav.videoId === videoId);
        const button = event.target.closest('.favorite-btn');

        if (favIndex === -1) {
            favorites.push({ videoId, title, thumbnail, date: new Date().toISOString() });
            button.classList.add('active');
            showToast('Added to favorites!');
        } else {
            favorites.splice(favIndex, 1);
            button.classList.remove('active');
            showToast('Removed from favorites!');
        }

        localStorage.setItem('favorites', JSON.stringify(favorites));

        if (document.getElementById('mePage').classList.contains('active')) {
            updateMeTabStats();
        }
    }

    async function fetchForYouContent() {
        const user = auth.currentUser;
        if (!user) return;

        const preferences = JSON.parse(localStorage.getItem('userPreferences'));
        if (!preferences || !preferences.contentType) return;

        showLoading(true);
        try {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(preferences.contentType + ' trailer OR full movie')}&type=video&key=${getApiKey()}`);
            const data = await response.json();
            if (data.error) {
                if (data.error.code === 403) {
                    switchApiKey();
                    return fetchForYouContent();
                }
                throw new Error(data.error.message);
            }

            const forYouDiv = document.getElementById('forYouResults');
            forYouDiv.innerHTML = '';
            document.getElementById('forYouSection').style.display = 'block';

            data.items.forEach((video, index) => {
                forYouDiv.appendChild(generateVideoCard(video, index < 3));
            });
        } catch (error) {
            showError(`Failed to load For You content: ${error.message}`);
            console.error('Error fetching For You:', error);
        } finally {
            showLoading(false);
        }
    }

    async function searchContent() {
        const query = document.getElementById('search').value.trim();
        if (!query) return;

        saveToHistory(query, "");
        let searches = JSON.parse(localStorage.getItem('searchCount')) || 0;
        searches += 1;
        localStorage.setItem('searchCount', JSON.stringify(searches));

        if (document.getElementById('mePage').classList.contains('active')) {
            updateMeTabStats();
        }

        showLoading(true);
        try {
            const trailerResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query + ' trailer')}&type=video&key=${getApiKey()}`);
            const trailerData = await trailerResponse.json();
            if (trailerData.error) {
                if (trailerData.error.code === 403) {
                    switchApiKey();
                    return searchContent();
                }
                throw new Error(trailerData.error.message);
            }

            const movieResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query + ' full movie -trailer')}&type=video&videoDuration=long&key=${getApiKey()}`);
            const movieData = await movieResponse.json();
            if (movieData.error) {
                if (movieData.error.code === 403) {
                    switchApiKey();
                    return searchContent();
                }
                throw new Error(movieData.error.message);
            }

            const animeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(query + ' anime trailer OR full movie')}&type=video&key=${getApiKey()}`);
            const animeData = await animeResponse.json();
            if (animeData.error) {
                if (animeData.error.code === 403) {
                    switchApiKey();
                    return searchContent();
                }
                throw new Error(animeData.error.message);
            }

            const movieVideoIds = movieData.items.map(item => item.id.videoId).join(',');
            const movieDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${movieVideoIds}&key=${getApiKey()}`);
            const movieDetailsData = await movieDetailsResponse.json();
            const fullMovies = movieData.items.map(item => ({
                ...item,
                contentDetails: movieDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
            }));

            const animeVideoIds = animeData.items.map(item => item.id.videoId).join(',');
            const animeDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${animeVideoIds}&key=${getApiKey()}`);
            const animeDetailsData = await animeDetailsResponse.json();
            const fullAnime = animeData.items.map(item => ({
                ...item,
                contentDetails: animeDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
            }));

            exploreTotalResults = [
                ...trailerData.items,
                ...fullMovies.filter(isFullLengthVideo),
                ...fullAnime.filter(video => isFullLengthVideo(video) && isAnimeRelated(video))
            ].sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));

            exploreCurrentPage = 0;
            displaySearchResults();
            updatePagination();
            saveToHistory(query, exploreTotalResults[0]?.snippet?.thumbnails?.medium?.url || '');
        } catch (error) {
            showError(`Failed to search: ${error.message}`);
            console.error('Search error:', error);
        } finally {
            showLoading(false);
        }
    }

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            searchContent();
        }
    }

    function displaySearchResults() {
        const searchDiv = document.getElementById('searchResults');
        const contentDiv = document.getElementById('exploreContent');
        searchDiv.innerHTML = '';

        if (exploreTotalResults.length === 0) {
            searchDiv.innerHTML = `<div class="empty-state"><i class="fas fa-compass"></i><p>No results found</p></div>`;
            contentDiv.style.display = 'none';
            searchDiv.style.display = 'block';
            document.getElementById('explorePagination').style.display = 'none';
            return;
        }

        contentDiv.style.display = 'none';
        searchDiv.style.display = 'block';

        const start = exploreCurrentPage * resultsPerPage;
        const end = start + resultsPerPage;
        const videos = exploreTotalResults.slice(start, end);

        videos.forEach((video, index) => {
            searchDiv.appendChild(generateVideoCard(video, index < 3));
        });

        document.getElementById('explorePagination').style.display = 'flex';
    }

    function updatePagination() {
        document.getElementById('explorePrevBtn').disabled = exploreCurrentPage === 0;
        document.getElementById('exploreNextBtn').disabled = (exploreCurrentPage + 1) * resultsPerPage >= exploreTotalResults.length;
    }

    function prevPage() {
        if (exploreCurrentPage > 0) {
            exploreCurrentPage--;
            displaySearchResults();
            updatePagination();
        }
    }

    function nextPage() {
        if ((exploreCurrentPage + 1) * resultsPerPage < exploreTotalResults.length) {
            exploreCurrentPage++;
            displaySearchResults();
            updatePagination();
        }
    }

    function isFullLengthVideo(video) {
        const duration = video.contentDetails?.duration;
        if (!duration) return false;

        const regex = /PT(\d+H)?(\d+M)?(\d+S)?/;
        const matches = duration.match(regex);
        if (!matches) return false;

        const hours = parseInt(matches[1]) || 0;
        const minutes = parseInt(matches[2]) || 0;
        const seconds = parseInt(matches[3]) || 0;
        const totalSeconds = hours * 3600 + minutes * 60 + seconds;

        return totalSeconds >= 60;
    }

    function isAnimeRelated(video) {
        const title = video.snippet.title?.toLowerCase() || '';
        const description = video.snippet.description?.toLowerCase() || '';

        const animeKeywords = [
            'anime', 'episode', 'series', 'season', 'part', 'opening', 'ending',
            'dub', 'sub', 'subbed', 'dubbed', 'watch online', 'full episode',
            'naruto', 'one piece', 'bleach', 'attack on titan',
            'my hero', 'boku no hero', 'mha', 'demon slayer', 'tokyo ghoul', 'dragon ball',
            'sailor moon', 'cowboy bebop', 'code geass', 'death note', 'evangelion',
            'pokemon', 'dbz', 'goku', 'luffy', 'eren', 'levi', 'itachi', 'madara',
            'shonen', 'shoujo', 'isekai', 'mecha', 'fantasy', 'adventure', 'action',
            'comedy', 'romance', 'slice of life', 'ecchi', 'harem', 'school', 'horror',
            'crunchyroll', 'funimation', 'animelab', 'neon genesis', 'myanimelist',
            'aniplex', 'madhouse', 'ufotable', 'bones', 'studio pierrot'
        ];

        return animeKeywords.some(kw => title.includes(kw) || description.includes(kw));
    }

    function sortItemsByPublishedDate(items) {
        return items.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
    }

    function playVideo(videoId, title, thumbnail) {
        let watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
        watchHistory.unshift({ videoId, title, thumbnail, date: new Date().toISOString() });
        if (watchHistory.length > 100) {
            watchHistory = watchHistory.slice(0, 100);
        }
        localStorage.setItem('watchHistory', JSON.stringify(watchHistory));

        if (document.getElementById('mePage').classList.contains('active')) {
            updateMeTabStats();
        }

        if (title) {
            saveToHistory(title, thumbnail);
        }

        const fallbackWindow = window.open(
            `fallback-player.html?v=${videoId}`,
            '_blank',
            'width=900,height=506'
        );

        setTimeout(() => {
            if (!fallbackWindow || fallbackWindow.closed) {
                window.open(
                    `https://www.youtube.com/watch?v=${videoId}`,
                    '_blank'
                );
            }
        }, 300);
    }

    function saveToHistory(query, thumbnail) {
        let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
        history = history.filter(item => item.query.toLowerCase() !== query.toLowerCase());
        history.unshift({ query, thumbnail, date: new Date().toISOString() });
        if (history.length > 10) {
            history = history.slice(0, 10);
        }
        localStorage.setItem('searchHistory', JSON.stringify(history));
    }

    function showAuthModal() {
        document.getElementById('authModal').style.display = 'block';
    }

    function closeAuthModal() {
        document.getElementById('authModal').style.display = 'none';
    }

    function toggleAuthMode() {
        isSignUpMode = !isSignUpMode;
        document.getElementById('authModalTitle').textContent = isSignUpMode ? 'Sign Up' : 'Login';
        document.getElementById('authSubmitBtn').textContent = isSignUpMode ? 'Sign Up' : 'Login';
        document.getElementById('authToggleText').textContent = isSignUpMode ? 'Login' : 'Sign Up';
        document.getElementById('contentPreferences').style.display = isSignUpMode ? 'block' : 'none';
        document.getElementById('authError').style.display = 'none';
    }

    function showAccountModal() {
        const modal = document.getElementById('accountModal');
        const user = JSON.parse(localStorage.getItem('userProfile')) || {};
        document.getElementById('userName').value = user.name || '';
        document.getElementById('userEmail').value = user.email || '';
        modal.style.display = 'block';
    }

    function closeModal() {
        document.getElementById('accountModal').style.display = 'none';
    }

    function saveAccount(e) {
        e.preventDefault();
        const userProfile = {
            name: document.getElementById('userName').value.trim(),
            email: document.getElementById('userEmail').value.trim(),
            joined: new Date().toISOString()
        };
        localStorage.setItem('userProfile', JSON.stringify(userProfile));
        updateUserStatus();
        closeModal();
        showToast('Profile saved successfully');
    }

    function signOut() {
        firebaseSignOut(auth).then(() => {
            localStorage.removeItem('userPreferences');
            document.getElementById('forYouSection').style.display = 'none';
            updateUserStatus();
            showToast('Signed out successfully');
            showAuthModal();
        }).catch(error => {
            showError(`Sign out failed: ${error.message}`);
            console.error('Sign out error:', error);
        });
    }

    function updateUserStatus() {
        const user = auth.currentUser;
        const userProfile = JSON.parse(localStorage.getItem('userProfile')) || {};
        const statusElement = document.getElementById('userStatus');
        const nameElement = document.getElementById('userProfileName');
        const avatarIcon = document.querySelector('.profile-avatar i');

        if (user) {
            nameElement.textContent = userProfile.name || user.email || 'User';
            statusElement.textContent = 'Premium Member';
            if (avatarIcon) {
                avatarIcon.className = 'fas fa-user-check';
                avatarIcon.parentElement.style.backgroundColor = '#4CAF50';
            }
        } else {
            nameElement.textContent = 'Guest User';
            statusElement.textContent = 'Basic Member';
            if (avatarIcon) {
                avatarIcon.className = 'fas fa-user';
                avatarIcon.parentElement.style.backgroundColor = 'var(--primary)';
            }
        }
    }

    function setTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.remove('light-mode');
            document.body.classList.add('dark-mode');
            localStorage.setItem('themePreference', 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            document.body.classList.add('light-mode');
            localStorage.setItem('themePreference', 'light');
        }
    }

    function toggleTheme() {
        const isLight = document.body.classList.contains('light-mode');
        setTheme(isLight ? 'dark' : 'light');
        showToast(`Switched to ${isLight ? 'Dark' : 'Light'} Mode`);
    }

    function showNotificationModal() {
        document.getElementById('notificationModal').style.display = 'block';
    }

    function hideNotificationModal() {
        document.getElementById('notificationModal').style.display = 'none';
    }

    function showAboutModal() {
        document.getElementById('aboutModal').style.display = 'block';
    }

    function hideAboutModal() {
        document.getElementById('aboutModal').style.display = 'none';
    }

    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }, 100);
    }

    function clearAllCache() {
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('preload-') || key.includes('Trending') || key.includes('Results')) {
                localStorage.removeItem(key);
            }
        });
        location.reload();
    }

    function updateMeTabStats() {
        const watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
        document.getElementById('watchHistoryCount').textContent = watchHistory.length;
        const searchCount = JSON.parse(localStorage.getItem('searchCount')) || 0;
        document.getElementById('searchHistoryCount').textContent = searchCount;
    }

    document.getElementById('authForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;
        const preferences = document.getElementById('contentPreferences').value;

        try {
            if (isSignUpMode) {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                console.log('User signed up:', userCredential.user);
                localStorage.setItem('userPreferences', JSON.stringify({ contentType: preferences }));
                showToast('Account created successfully!');
            } else {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('User logged in:', userCredential.user);
                showToast('Logged in successfully!');
            }
            closeAuthModal();
            updateUserStatus();
            fetchForYouContent();
        } catch (error) {
            console.error('Auth error:', error);
            showAuthError(error.message);
        }
    });

    onAuthStateChanged(auth, (user) => {
        console.log('Auth state changed:', user ? user.email : 'No user');
        updateUserStatus();
        if (user) {
            fetchForYouContent();
        } else {
            showAuthModal();
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('themePreference') || 'dark';
        setTheme(savedTheme);
        updateUserStatus();
        fetchExploreContent();

        // Search input event listeners
        const searchInput = document.getElementById('search');
        searchInput.addEventListener('focus', showSearchHistory);
        searchInput.addEventListener('blur', hideSearchHistory);
        searchInput.addEventListener('input', filterSearchHistory);
        searchInput.addEventListener('keypress', handleKeyPress);

        // Button event listeners
        document.getElementById('searchBtn').addEventListener('click', searchContent);
        document.getElementById('reloadBtn').addEventListener('click', clearAllCache);

        // Navigation event listeners
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = item.getAttribute('data-page');
                if (pageId) {
                    showPage(pageId);
                }
            });
        });

        // Auth modal event listeners
        document.getElementById('cancelAuthBtn').addEventListener('click', closeAuthModal);
        document.getElementById('toggleAuthBtn').addEventListener('click', toggleAuthMode);

        // Account modal event listeners
        document.getElementById('accountForm').addEventListener('submit', saveAccount);
        document.getElementById('cancelAccountBtn').addEventListener('click', closeModal);
        document.getElementById('signOutBtn').addEventListener('click', signOut);

        // Settings event listeners
        document.getElementById('accountBtn').addEventListener('click', showAccountModal);
        document.getElementById('themeBtn').addEventListener('click', toggleTheme);
        document.getElementById('notificationBtn').addEventListener('click', showNotificationModal);
        document.getElementById('aboutBtn').addEventListener('click', showAboutModal);

        // Notification modal event listener
        document.getElementById('closeNotificationBtn').addEventListener('click', hideNotificationModal);

        // Modal close on outside click
        window.addEventListener('click', (event) => {
            const authModal = document.getElementById('authModal');
            const accountModal = document.getElementById('accountModal');
            const notificationModal = document.getElementById('notificationModal');
            if (event.target === authModal) {
                closeAuthModal();
            }
            if (event.target === accountModal) {
                closeModal();
            }
            if (event.target === notificationModal) {
                hideNotificationModal();
            }
        });

        // Persist last search
        const lastSearch = localStorage.getItem('lastSearch');
        if (lastSearch) {
            searchInput.value = lastSearch;
        }
        searchInput.addEventListener('input', (e) => {
            localStorage.setItem('lastSearch', e.target.value);
        });
    });
</script>
</body>
</html>
